{"ast":null,"code":"import { __extends, __read, __spreadArray } from \"tslib\";\nimport { GlobalContainer } from 'mana-syringe';\nimport { isNil } from 'lodash-es';\nimport { SceneGraphService } from '../services/SceneGraphService';\nimport { Cullable, Geometry, Renderable, Transform, Sortable } from '../components';\nimport { Node } from './Node';\nimport { ElementEvent } from './interfaces';\nimport { formatAttribute } from '../utils';\nimport { MutationEvent } from './MutationEvent';\nvar entityCounter = 0;\n/**\n * Has following capabilities:\n * * Node insert/remove, eg. appendChild, removeChild, remove...\n * * Query eg. querySelector getElementById...\n * * Animation\n */\n\nvar Element =\n/** @class */\nfunction (_super) {\n  __extends(Element, _super);\n\n  function Element() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.sceneGraphService = GlobalContainer.get(SceneGraphService);\n    _this.entity = entityCounter++;\n    _this.renderable = new Renderable();\n    _this.cullable = new Cullable();\n    _this.transformable = new Transform();\n    _this.sortable = new Sortable();\n    _this.geometry = new Geometry();\n    /**\n     * https://developer.mozilla.org/zh-CN/docs/Web/API/Element/namespaceURI\n     */\n\n    _this.namespaceURI = 'g';\n    _this.scrollLeft = 0;\n    _this.scrollTop = 0;\n    /**\n     * We don't support border now\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/clientTop\n     */\n\n    _this.clientTop = 0;\n    _this.clientLeft = 0;\n    /**\n     * is destroyed or not\n     */\n\n    _this.destroyed = false;\n    /**\n     * compatible with `style`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style\n     */\n\n    _this.style = {};\n    _this.computedStyle = {};\n    _this.parsedStyle = {};\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/attributes\n     */\n\n    _this.attributes = {};\n    return _this;\n  }\n\n  Element.isElement = function (target) {\n    return !!target.getAttribute;\n  };\n\n  Object.defineProperty(Element.prototype, \"className\", {\n    /**\n     * used in `getElementsByClassName`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\n     */\n    get: function get() {\n      return this.getAttribute('class') || '';\n    },\n    set: function set(className) {\n      this.setAttribute('class', className);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"classList\", {\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/classList\n     */\n    get: function get() {\n      return this.className.split(' ').filter(function (c) {\n        return c !== '';\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"tagName\", {\n    get: function get() {\n      return this.nodeName;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"children\", {\n    get: function get() {\n      return this.childNodes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"childElementCount\", {\n    get: function get() {\n      return this.childNodes.length;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"firstElementChild\", {\n    get: function get() {\n      return this.firstChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"lastElementChild\", {\n    get: function get() {\n      return this.lastChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"parentElement\", {\n    get: function get() {\n      return this.parentNode;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"nextSibling\", {\n    get: function get() {\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        return this.parentNode.childNodes[index + 1] || null;\n      }\n\n      return null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"previousSibling\", {\n    get: function get() {\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        return this.parentNode.childNodes[index - 1] || null;\n      }\n\n      return null;\n    },\n    enumerable: false,\n    configurable: true\n  }); // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  Element.prototype.cloneNode = function (deep) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.appendChild = function (child, index) {\n    this.sceneGraphService.attach(child, this, index);\n    this.emit(ElementEvent.CHILD_INSERTED, {\n      child: child\n    }); // child.emit(ElementEvent.INSERTED, {\n    //   parent: this,\n    //   index,\n    // });\n\n    child.dispatchEvent(new MutationEvent(ElementEvent.INSERTED, this, '', '', '', 0, '', ''));\n    return child;\n  };\n\n  Element.prototype.insertBefore = function (newChild, refChild) {\n    if (!refChild) {\n      this.appendChild(newChild);\n    } else {\n      var index = this.childNodes.indexOf(refChild);\n      this.appendChild(newChild, index - 1);\n    }\n\n    return newChild;\n  };\n\n  Element.prototype.replaceChild = function (newChild, oldChild, destroy) {\n    var index = this.childNodes.indexOf(oldChild);\n    this.removeChild(oldChild, destroy);\n    this.appendChild(newChild, index);\n    return oldChild;\n  };\n\n  Element.prototype.removeChild = function (child, destroy) {\n    // should emit on itself before detach\n    // child.emit(ElementEvent.REMOVED, {\n    //   parent: this,\n    // });\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    child.dispatchEvent(new MutationEvent(ElementEvent.REMOVED, this, '', '', '', 0, '', '')); // emit destroy event\n\n    if (destroy) {\n      child.emit(ElementEvent.DESTROY, {});\n      child.destroyed = true;\n    } // emit on parent\n\n\n    this.emit(ElementEvent.CHILD_REMOVED, {\n      child: child\n    }); // remove from scene graph\n\n    this.sceneGraphService.detach(child); // cannot emit Destroy event now\n\n    if (destroy) {\n      // this.removeChildren();\n      // remove event listeners\n      child.emitter.removeAllListeners();\n    }\n\n    return child;\n  };\n\n  Element.prototype.removeChildren = function (destroy) {\n    var _this = this;\n\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    this.childNodes.slice().forEach(function (child) {\n      _this.removeChild(child, destroy);\n    });\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\n   */\n\n\n  Element.prototype.matches = function (selector) {\n    return this.sceneGraphService.matches(selector, this);\n  };\n\n  Element.prototype.getElementById = function (id) {\n    return this.sceneGraphService.querySelector(\"#\".concat(id), this);\n  };\n\n  Element.prototype.getElementsByName = function (name) {\n    return this.sceneGraphService.querySelectorAll(\"[name=\\\"\".concat(name, \"\\\"]\"), this);\n  };\n\n  Element.prototype.getElementsByClassName = function (className) {\n    return this.sceneGraphService.querySelectorAll(\".\".concat(className), this);\n  };\n\n  Element.prototype.getElementsByTagName = function (tagName) {\n    return this.sceneGraphService.querySelectorAll(tagName, this);\n  };\n\n  Element.prototype.querySelector = function (selectors) {\n    return this.sceneGraphService.querySelector(selectors, this);\n  };\n\n  Element.prototype.querySelectorAll = function (selectors) {\n    return this.sceneGraphService.querySelectorAll(selectors, this);\n  };\n  /**\n   * search in scene group, but should not include itself\n   */\n\n\n  Element.prototype.find = function (filter) {\n    var _this = this;\n\n    var target = null;\n    this.forEach(function (object) {\n      if (object !== _this && filter(object)) {\n        target = object;\n        return true;\n      }\n\n      return false;\n    });\n    return target;\n  };\n\n  Element.prototype.findAll = function (filter) {\n    var _this = this;\n\n    var objects = [];\n    this.forEach(function (object) {\n      if (object !== _this && filter(object)) {\n        objects.push(object);\n      }\n    });\n    return objects;\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/after\n   */\n\n\n  Element.prototype.after = function () {\n    var _this = this;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    if (this.parentNode) {\n      var index_1 = this.parentNode.childNodes.indexOf(this);\n      nodes.forEach(function (node, i) {\n        var _a;\n\n        return (_a = _this.parentNode) === null || _a === void 0 ? void 0 : _a.appendChild(node, index_1 + i + 1);\n      });\n    }\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/before\n   */\n\n\n  Element.prototype.before = function () {\n    var _a;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    if (this.parentNode) {\n      var index = this.parentNode.childNodes.indexOf(this);\n\n      var _b = __read(nodes),\n          first = _b[0],\n          rest = _b.slice(1);\n\n      this.parentNode.appendChild(first, index);\n\n      (_a = first).after.apply(_a, __spreadArray([], __read(rest), false));\n    }\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceWith\n   */\n\n\n  Element.prototype.replaceWith = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    this.after.apply(this, __spreadArray([], __read(nodes), false));\n    this.remove();\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/append\n   */\n\n\n  Element.prototype.append = function () {\n    var _this = this;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    nodes.forEach(function (node) {\n      return _this.appendChild(node);\n    });\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/prepend\n   */\n\n\n  Element.prototype.prepend = function () {\n    var _this = this;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    nodes.forEach(function (node, i) {\n      return _this.appendChild(node, i);\n    });\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceChildren\n   */\n\n\n  Element.prototype.replaceChildren = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    while (this.childNodes.length && this.firstChild) {\n      this.removeChild(this.firstChild);\n    }\n\n    this.append.apply(this, __spreadArray([], __read(nodes), false));\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/remove\n   */\n\n\n  Element.prototype.remove = function (destroy) {\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    if (this.parentNode) {\n      return this.parentNode.removeChild(this, destroy);\n    }\n\n    return this;\n  };\n\n  Element.prototype.destroy = function () {\n    // destroy itself before remove\n    this.emit(ElementEvent.DESTROY, {}); // remove from scenegraph first\n\n    this.remove(false); // remove event listeners\n\n    this.emitter.removeAllListeners();\n    this.destroyed = true;\n  };\n\n  Element.prototype.getGeometryBounds = function () {\n    return this.sceneGraphService.getGeometryBounds(this);\n  };\n\n  Element.prototype.getRenderBounds = function () {\n    return this.sceneGraphService.getBounds(this, true);\n  };\n  /**\n   * get bounds in world space, account for children\n   */\n\n\n  Element.prototype.getBounds = function () {\n    return this.sceneGraphService.getBounds(this);\n  };\n  /**\n   * get bounds in local space, account for children\n   */\n\n\n  Element.prototype.getLocalBounds = function () {\n    return this.sceneGraphService.getLocalBounds(this);\n  };\n  /**\n   * account for context's bounds in client space,\n   * but not accounting for children\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n   */\n\n\n  Element.prototype.getBoundingClientRect = function () {\n    return this.sceneGraphService.getBoundingClientRect(this);\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getClientRects\n   */\n\n\n  Element.prototype.getClientRects = function () {\n    return [this.getBoundingClientRect()];\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/computedStyleMap\n   * eg. circle.computedStyleMap().get('fill');\n   */\n\n\n  Element.prototype.computedStyleMap = function () {\n    return new Map(Object.entries(this.computedStyle));\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNames\n   */\n\n\n  Element.prototype.getAttributeNames = function () {\n    return Object.keys(this.attributes);\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute\n   */\n\n\n  Element.prototype.getAttribute = function (name) {\n    var _a = __read(formatAttribute(name.toString(), ''), 1),\n        attributeName = _a[0];\n\n    var value = this.attributes[attributeName]; // if the given attribute does not exist, the value returned will either be null or \"\"\n\n    return isNil(value) ? null : value;\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttribute\n   */\n\n\n  Element.prototype.hasAttribute = function (qualifiedName) {\n    return this.getAttributeNames().includes(qualifiedName);\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttributes\n   */\n\n\n  Element.prototype.hasAttributes = function () {\n    return !!this.getAttributeNames().length;\n  };\n  /**\n   * should use removeAttribute() instead of setting the attribute value to null either directly or using setAttribute(). Many attributes will not behave as expected if you set them to null.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/removeAttribute\n   */\n\n\n  Element.prototype.removeAttribute = function (attributeName) {\n    delete this.attributes[attributeName];\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute\n   */\n\n\n  Element.prototype.setAttribute = function (attributeName, value, // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  force) {\n    if (force === void 0) {\n      force = false;\n    }\n\n    this.attributes[attributeName] = value;\n  };\n\n  Element.prototype.getAttributeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.getAttributeNode = function (qualifiedName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.getAttributeNodeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.hasAttributeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.removeAttributeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.removeAttributeNode = function (attr) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.setAttributeNS = function (namespace, qualifiedName, value) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.setAttributeNode = function (attr) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.setAttributeNodeNS = function (attr) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.toggleAttribute = function (qualifiedName, force) {\n    throw new Error('Method not implemented.');\n  };\n\n  return Element;\n}(Node);\n\nexport { Element };","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/@antv/g/es/dom/Element.js"],"names":["__extends","__read","__spreadArray","GlobalContainer","isNil","SceneGraphService","Cullable","Geometry","Renderable","Transform","Sortable","Node","ElementEvent","formatAttribute","MutationEvent","entityCounter","Element","_super","_this","apply","arguments","sceneGraphService","get","entity","renderable","cullable","transformable","sortable","geometry","namespaceURI","scrollLeft","scrollTop","clientTop","clientLeft","destroyed","style","computedStyle","parsedStyle","attributes","isElement","target","getAttribute","Object","defineProperty","prototype","set","className","setAttribute","enumerable","configurable","split","filter","c","nodeName","childNodes","length","firstChild","lastChild","parentNode","index","indexOf","cloneNode","deep","Error","appendChild","child","attach","emit","CHILD_INSERTED","dispatchEvent","INSERTED","insertBefore","newChild","refChild","replaceChild","oldChild","destroy","removeChild","REMOVED","DESTROY","CHILD_REMOVED","detach","emitter","removeAllListeners","removeChildren","slice","forEach","matches","selector","getElementById","id","querySelector","concat","getElementsByName","name","querySelectorAll","getElementsByClassName","getElementsByTagName","tagName","selectors","find","object","findAll","objects","push","after","nodes","_i","index_1","node","i","_a","before","_b","first","rest","replaceWith","remove","append","prepend","replaceChildren","getGeometryBounds","getRenderBounds","getBounds","getLocalBounds","getBoundingClientRect","getClientRects","computedStyleMap","Map","entries","getAttributeNames","keys","toString","attributeName","value","hasAttribute","qualifiedName","includes","hasAttributes","removeAttribute","force","getAttributeNS","namespace","localName","getAttributeNode","getAttributeNodeNS","hasAttributeNS","removeAttributeNS","removeAttributeNode","attr","setAttributeNS","setAttributeNode","setAttributeNodeNS","toggleAttribute"],"mappings":"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","sourcesContent":["import { __extends, __read, __spreadArray } from \"tslib\";\nimport { GlobalContainer } from 'mana-syringe';\nimport { isNil } from 'lodash-es';\nimport { SceneGraphService } from '../services/SceneGraphService';\nimport { Cullable, Geometry, Renderable, Transform, Sortable } from '../components';\nimport { Node } from './Node';\nimport { ElementEvent } from './interfaces';\nimport { formatAttribute } from '../utils';\nimport { MutationEvent } from './MutationEvent';\nvar entityCounter = 0;\n/**\n * Has following capabilities:\n * * Node insert/remove, eg. appendChild, removeChild, remove...\n * * Query eg. querySelector getElementById...\n * * Animation\n */\n\nvar Element =\n/** @class */\nfunction (_super) {\n  __extends(Element, _super);\n\n  function Element() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.sceneGraphService = GlobalContainer.get(SceneGraphService);\n    _this.entity = entityCounter++;\n    _this.renderable = new Renderable();\n    _this.cullable = new Cullable();\n    _this.transformable = new Transform();\n    _this.sortable = new Sortable();\n    _this.geometry = new Geometry();\n    /**\n     * https://developer.mozilla.org/zh-CN/docs/Web/API/Element/namespaceURI\n     */\n\n    _this.namespaceURI = 'g';\n    _this.scrollLeft = 0;\n    _this.scrollTop = 0;\n    /**\n     * We don't support border now\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/clientTop\n     */\n\n    _this.clientTop = 0;\n    _this.clientLeft = 0;\n    /**\n     * is destroyed or not\n     */\n\n    _this.destroyed = false;\n    /**\n     * compatible with `style`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style\n     */\n\n    _this.style = {};\n    _this.computedStyle = {};\n    _this.parsedStyle = {};\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/attributes\n     */\n\n    _this.attributes = {};\n    return _this;\n  }\n\n  Element.isElement = function (target) {\n    return !!target.getAttribute;\n  };\n\n  Object.defineProperty(Element.prototype, \"className\", {\n    /**\n     * used in `getElementsByClassName`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\n     */\n    get: function get() {\n      return this.getAttribute('class') || '';\n    },\n    set: function set(className) {\n      this.setAttribute('class', className);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"classList\", {\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/classList\n     */\n    get: function get() {\n      return this.className.split(' ').filter(function (c) {\n        return c !== '';\n      });\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"tagName\", {\n    get: function get() {\n      return this.nodeName;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"children\", {\n    get: function get() {\n      return this.childNodes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"childElementCount\", {\n    get: function get() {\n      return this.childNodes.length;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"firstElementChild\", {\n    get: function get() {\n      return this.firstChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"lastElementChild\", {\n    get: function get() {\n      return this.lastChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"parentElement\", {\n    get: function get() {\n      return this.parentNode;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"nextSibling\", {\n    get: function get() {\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        return this.parentNode.childNodes[index + 1] || null;\n      }\n\n      return null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Element.prototype, \"previousSibling\", {\n    get: function get() {\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        return this.parentNode.childNodes[index - 1] || null;\n      }\n\n      return null;\n    },\n    enumerable: false,\n    configurable: true\n  }); // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  Element.prototype.cloneNode = function (deep) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.appendChild = function (child, index) {\n    this.sceneGraphService.attach(child, this, index);\n    this.emit(ElementEvent.CHILD_INSERTED, {\n      child: child\n    }); // child.emit(ElementEvent.INSERTED, {\n    //   parent: this,\n    //   index,\n    // });\n\n    child.dispatchEvent(new MutationEvent(ElementEvent.INSERTED, this, '', '', '', 0, '', ''));\n    return child;\n  };\n\n  Element.prototype.insertBefore = function (newChild, refChild) {\n    if (!refChild) {\n      this.appendChild(newChild);\n    } else {\n      var index = this.childNodes.indexOf(refChild);\n      this.appendChild(newChild, index - 1);\n    }\n\n    return newChild;\n  };\n\n  Element.prototype.replaceChild = function (newChild, oldChild, destroy) {\n    var index = this.childNodes.indexOf(oldChild);\n    this.removeChild(oldChild, destroy);\n    this.appendChild(newChild, index);\n    return oldChild;\n  };\n\n  Element.prototype.removeChild = function (child, destroy) {\n    // should emit on itself before detach\n    // child.emit(ElementEvent.REMOVED, {\n    //   parent: this,\n    // });\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    child.dispatchEvent(new MutationEvent(ElementEvent.REMOVED, this, '', '', '', 0, '', '')); // emit destroy event\n\n    if (destroy) {\n      child.emit(ElementEvent.DESTROY, {});\n      child.destroyed = true;\n    } // emit on parent\n\n\n    this.emit(ElementEvent.CHILD_REMOVED, {\n      child: child\n    }); // remove from scene graph\n\n    this.sceneGraphService.detach(child); // cannot emit Destroy event now\n\n    if (destroy) {\n      // this.removeChildren();\n      // remove event listeners\n      child.emitter.removeAllListeners();\n    }\n\n    return child;\n  };\n\n  Element.prototype.removeChildren = function (destroy) {\n    var _this = this;\n\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    this.childNodes.slice().forEach(function (child) {\n      _this.removeChild(child, destroy);\n    });\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\n   */\n\n\n  Element.prototype.matches = function (selector) {\n    return this.sceneGraphService.matches(selector, this);\n  };\n\n  Element.prototype.getElementById = function (id) {\n    return this.sceneGraphService.querySelector(\"#\".concat(id), this);\n  };\n\n  Element.prototype.getElementsByName = function (name) {\n    return this.sceneGraphService.querySelectorAll(\"[name=\\\"\".concat(name, \"\\\"]\"), this);\n  };\n\n  Element.prototype.getElementsByClassName = function (className) {\n    return this.sceneGraphService.querySelectorAll(\".\".concat(className), this);\n  };\n\n  Element.prototype.getElementsByTagName = function (tagName) {\n    return this.sceneGraphService.querySelectorAll(tagName, this);\n  };\n\n  Element.prototype.querySelector = function (selectors) {\n    return this.sceneGraphService.querySelector(selectors, this);\n  };\n\n  Element.prototype.querySelectorAll = function (selectors) {\n    return this.sceneGraphService.querySelectorAll(selectors, this);\n  };\n  /**\n   * search in scene group, but should not include itself\n   */\n\n\n  Element.prototype.find = function (filter) {\n    var _this = this;\n\n    var target = null;\n    this.forEach(function (object) {\n      if (object !== _this && filter(object)) {\n        target = object;\n        return true;\n      }\n\n      return false;\n    });\n    return target;\n  };\n\n  Element.prototype.findAll = function (filter) {\n    var _this = this;\n\n    var objects = [];\n    this.forEach(function (object) {\n      if (object !== _this && filter(object)) {\n        objects.push(object);\n      }\n    });\n    return objects;\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/after\n   */\n\n\n  Element.prototype.after = function () {\n    var _this = this;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    if (this.parentNode) {\n      var index_1 = this.parentNode.childNodes.indexOf(this);\n      nodes.forEach(function (node, i) {\n        var _a;\n\n        return (_a = _this.parentNode) === null || _a === void 0 ? void 0 : _a.appendChild(node, index_1 + i + 1);\n      });\n    }\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/before\n   */\n\n\n  Element.prototype.before = function () {\n    var _a;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    if (this.parentNode) {\n      var index = this.parentNode.childNodes.indexOf(this);\n\n      var _b = __read(nodes),\n          first = _b[0],\n          rest = _b.slice(1);\n\n      this.parentNode.appendChild(first, index);\n\n      (_a = first).after.apply(_a, __spreadArray([], __read(rest), false));\n    }\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceWith\n   */\n\n\n  Element.prototype.replaceWith = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    this.after.apply(this, __spreadArray([], __read(nodes), false));\n    this.remove();\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/append\n   */\n\n\n  Element.prototype.append = function () {\n    var _this = this;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    nodes.forEach(function (node) {\n      return _this.appendChild(node);\n    });\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/prepend\n   */\n\n\n  Element.prototype.prepend = function () {\n    var _this = this;\n\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    nodes.forEach(function (node, i) {\n      return _this.appendChild(node, i);\n    });\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceChildren\n   */\n\n\n  Element.prototype.replaceChildren = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    while (this.childNodes.length && this.firstChild) {\n      this.removeChild(this.firstChild);\n    }\n\n    this.append.apply(this, __spreadArray([], __read(nodes), false));\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/remove\n   */\n\n\n  Element.prototype.remove = function (destroy) {\n    if (destroy === void 0) {\n      destroy = true;\n    }\n\n    if (this.parentNode) {\n      return this.parentNode.removeChild(this, destroy);\n    }\n\n    return this;\n  };\n\n  Element.prototype.destroy = function () {\n    // destroy itself before remove\n    this.emit(ElementEvent.DESTROY, {}); // remove from scenegraph first\n\n    this.remove(false); // remove event listeners\n\n    this.emitter.removeAllListeners();\n    this.destroyed = true;\n  };\n\n  Element.prototype.getGeometryBounds = function () {\n    return this.sceneGraphService.getGeometryBounds(this);\n  };\n\n  Element.prototype.getRenderBounds = function () {\n    return this.sceneGraphService.getBounds(this, true);\n  };\n  /**\n   * get bounds in world space, account for children\n   */\n\n\n  Element.prototype.getBounds = function () {\n    return this.sceneGraphService.getBounds(this);\n  };\n  /**\n   * get bounds in local space, account for children\n   */\n\n\n  Element.prototype.getLocalBounds = function () {\n    return this.sceneGraphService.getLocalBounds(this);\n  };\n  /**\n   * account for context's bounds in client space,\n   * but not accounting for children\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n   */\n\n\n  Element.prototype.getBoundingClientRect = function () {\n    return this.sceneGraphService.getBoundingClientRect(this);\n  };\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getClientRects\n   */\n\n\n  Element.prototype.getClientRects = function () {\n    return [this.getBoundingClientRect()];\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/computedStyleMap\n   * eg. circle.computedStyleMap().get('fill');\n   */\n\n\n  Element.prototype.computedStyleMap = function () {\n    return new Map(Object.entries(this.computedStyle));\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNames\n   */\n\n\n  Element.prototype.getAttributeNames = function () {\n    return Object.keys(this.attributes);\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute\n   */\n\n\n  Element.prototype.getAttribute = function (name) {\n    var _a = __read(formatAttribute(name.toString(), ''), 1),\n        attributeName = _a[0];\n\n    var value = this.attributes[attributeName]; // if the given attribute does not exist, the value returned will either be null or \"\"\n\n    return isNil(value) ? null : value;\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttribute\n   */\n\n\n  Element.prototype.hasAttribute = function (qualifiedName) {\n    return this.getAttributeNames().includes(qualifiedName);\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttributes\n   */\n\n\n  Element.prototype.hasAttributes = function () {\n    return !!this.getAttributeNames().length;\n  };\n  /**\n   * should use removeAttribute() instead of setting the attribute value to null either directly or using setAttribute(). Many attributes will not behave as expected if you set them to null.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/removeAttribute\n   */\n\n\n  Element.prototype.removeAttribute = function (attributeName) {\n    delete this.attributes[attributeName];\n  };\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute\n   */\n\n\n  Element.prototype.setAttribute = function (attributeName, value, // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  force) {\n    if (force === void 0) {\n      force = false;\n    }\n\n    this.attributes[attributeName] = value;\n  };\n\n  Element.prototype.getAttributeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.getAttributeNode = function (qualifiedName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.getAttributeNodeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.hasAttributeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.removeAttributeNS = function (namespace, localName) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.removeAttributeNode = function (attr) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.setAttributeNS = function (namespace, qualifiedName, value) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.setAttributeNode = function (attr) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.setAttributeNodeNS = function (attr) {\n    throw new Error('Method not implemented.');\n  };\n\n  Element.prototype.toggleAttribute = function (qualifiedName, force) {\n    throw new Error('Method not implemented.');\n  };\n\n  return Element;\n}(Node);\n\nexport { Element };"]},"metadata":{},"sourceType":"module"}