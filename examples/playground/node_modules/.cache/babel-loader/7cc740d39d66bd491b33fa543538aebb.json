{"ast":null,"code":"function ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nimport { isInversifyRegister } from './inversify';\nimport { bindNamed, bindGeneralToken, bindMonoToken, bindLifecycle } from './inversify';\nimport { Utils, Syringe } from './core';\nimport { OptionSymbol } from './side-option';\nimport { Container } from './container';\nexport function toRegistryOption(options) {\n  var token = Utils.toArray(options.token);\n  var useClass = Utils.toArray(options.useClass);\n  var useDynamic = Utils.toArray(options.useDynamic);\n  var useFactory = Utils.toArray(options.useFactory);\n  var contrib = Utils.toArray(options.contrib);\n  var lifecycle = options.lifecycle || Syringe.Lifecycle.transient;\n  var generalOption = {\n    token: token,\n    useClass: useClass,\n    lifecycle: contrib.length > 0 ? Syringe.Lifecycle.singleton : lifecycle,\n    contrib: contrib,\n    useDynamic: useDynamic,\n    useFactory: useFactory\n  };\n\n  if ('useValue' in options) {\n    generalOption.useValue = options.useValue;\n  }\n\n  return generalOption;\n}\nexport var Register = /*#__PURE__*/function () {\n  function Register(register, token, option) {\n    _classCallCheck(this, Register);\n\n    this.token = void 0;\n    this.rawToken = void 0;\n    this.named = void 0;\n    this.generalToken = void 0;\n    this.option = void 0;\n    this.register = void 0;\n    this.mutiple = void 0;\n    this.register = register;\n    this.token = token;\n    this.option = option;\n    this.rawToken = Utils.isNamedToken(token) ? token.token : token;\n    this.named = Utils.isNamedToken(token) ? token.named : undefined;\n    this.mutiple = !!this.named || Utils.isMultipleEnabled(this.rawToken);\n    this.generalToken = this.rawToken;\n  }\n  /**\n   * multi or mono register\n   * mono bind 优先级 useValue > useDynamic > useFactory > useClass\n   */\n\n\n  _createClass(Register, [{\n    key: \"resolve\",\n    value: function resolve() {\n      var _this = this;\n\n      var register = this.register;\n\n      if (!isInversifyRegister(register)) {\n        return;\n      }\n\n      if (this.mutiple) {\n        this.resolveMutilple(register);\n      } else {\n        this.resolveMono(register);\n\n        if (!this.named && this.option.contrib.length > 0) {\n          this.option.contrib.forEach(function (contribution) {\n            if (Utils.isMultipleEnabled(contribution)) {\n              bindGeneralToken(contribution, register).toService(_this.generalToken);\n            } else {\n              bindMonoToken(contribution, register).toService(_this.generalToken);\n            }\n          });\n        }\n      }\n    } // eslint-disable-next-line consistent-return\n\n  }, {\n    key: \"resolveMono\",\n    value: function resolveMono(register) {\n      if ('useValue' in this.option) {\n        return bindMonoToken(this.generalToken, register).toConstantValue(this.option.useValue);\n      }\n\n      if (this.option.useDynamic.length > 0) {\n        var dynamic = this.option.useDynamic[this.option.useDynamic.length - 1];\n        return bindLifecycle(bindMonoToken(this.generalToken, register).toDynamicValue(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return dynamic({\n            container: container\n          });\n        }), this.option);\n      }\n\n      if (this.option.useFactory.length > 0) {\n        var factrory = this.option.useFactory[this.option.useFactory.length - 1];\n        return bindMonoToken(this.generalToken, register).toFactory(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return factrory({\n            container: container\n          });\n        });\n      }\n\n      if (this.option.useClass.length > 0) {\n        var newable = this.option.useClass[this.option.useClass.length - 1];\n        return bindLifecycle(bindMonoToken(this.generalToken, register).to(newable), this.option);\n      }\n    }\n  }, {\n    key: \"resolveMutilple\",\n    value: function resolveMutilple(register) {\n      var _this2 = this;\n\n      var classesList = this.option.useClass.map(function (newable) {\n        return bindLifecycle(bindGeneralToken(_this2.generalToken, register).to(newable), _this2.option);\n      });\n      var dynamicList = this.option.useDynamic.map(function (dynamic) {\n        return bindLifecycle(bindGeneralToken(_this2.generalToken, register).toDynamicValue(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return dynamic({\n            container: container\n          });\n        }), _this2.option);\n      });\n      var factoryList = this.option.useFactory.map(function (factrory) {\n        return bindGeneralToken(_this2.generalToken, register).toFactory(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return factrory({\n            container: container\n          });\n        });\n      });\n      var valueToBind = 'useValue' in this.option ? bindGeneralToken(this.generalToken, register).toConstantValue(this.option.useValue) : undefined;\n\n      if (this.named) {\n        classesList.forEach(function (tobind) {\n          return _this2.named && bindNamed(tobind, _this2.named);\n        });\n        dynamicList.forEach(function (tobind) {\n          return _this2.named && bindNamed(tobind, _this2.named);\n        });\n        factoryList.forEach(function (tobind) {\n          return _this2.named && bindNamed(tobind, _this2.named);\n        });\n\n        if (valueToBind) {\n          bindNamed(valueToBind, this.named);\n        }\n      }\n    }\n  }], [{\n    key: \"resolveTarget\",\n    value: // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    /**\n     * 注册目标 token，合并 token 配置后基于配置注册\n     */\n    function resolveTarget(register, target) {\n      var option = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      try {\n        try {\n          var sideOption = Reflect.getMetadata(OptionSymbol, target);\n\n          if (sideOption) {\n            Register.resolveOption(register, sideOption);\n          }\n        } catch (ex) {// noop\n        } // 当 target 为类时，将其插入 useClass 配置中\n\n\n        if (Utils.isClass(target)) {\n          if (!option.useClass) {\n            option.useClass = [target];\n          } else {\n            var classes = Utils.toArray(option.useClass);\n            classes.unshift(target);\n            option.useClass = classes;\n          }\n        }\n\n        var mixedOption;\n\n        try {\n          mixedOption = Reflect.getMetadata(Syringe.ClassOptionSymbol, target);\n        } catch (ex) {// noop\n        }\n\n        mixedOption = _objectSpread(_objectSpread({}, mixedOption || {}), option);\n\n        if (!mixedOption.token) {\n          mixedOption.token = [target];\n        } else {\n          var tokens = Utils.toArray(mixedOption.token);\n          tokens.unshift(target);\n          mixedOption.token = tokens;\n        }\n\n        Register.resolveOption(register, mixedOption);\n      } catch (ex) {// noop\n      }\n    }\n    /**\n     * 基于配置注册\n     */\n\n  }, {\n    key: \"resolveOption\",\n    value: function resolveOption(iRegister, baseOption) {\n      var parsedOption = toRegistryOption(_objectSpread(_objectSpread({}, Register.globalConfig), baseOption));\n\n      if (parsedOption.useClass.length === 0 && parsedOption.useDynamic.length === 0 && parsedOption.useFactory.length === 0 && !('useValue' in parsedOption)) {\n        return;\n      }\n\n      parsedOption.token.forEach(function (token) {\n        var register = new Register(iRegister, token, _objectSpread({}, parsedOption));\n        register.resolve();\n      });\n    }\n  }]);\n\n  return Register;\n}();\nRegister.globalConfig = Syringe.DefaultOption;","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/mana-syringe/es/register.js"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","prototype","isInversifyRegister","bindNamed","bindGeneralToken","bindMonoToken","bindLifecycle","Utils","Syringe","OptionSymbol","Container","toRegistryOption","options","token","toArray","useClass","useDynamic","useFactory","contrib","lifecycle","Lifecycle","transient","generalOption","singleton","useValue","Register","register","option","rawToken","named","generalToken","mutiple","isNamedToken","undefined","isMultipleEnabled","resolve","_this","resolveMutilple","resolveMono","contribution","toService","toConstantValue","dynamic","toDynamicValue","ctx","container","getContainer","factrory","toFactory","newable","to","_this2","classesList","map","dynamicList","factoryList","valueToBind","tobind","resolveTarget","sideOption","Reflect","getMetadata","resolveOption","ex","isClass","classes","unshift","mixedOption","ClassOptionSymbol","tokens","iRegister","baseOption","parsedOption","globalConfig","DefaultOption"],"mappings":"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","sourcesContent":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nimport { isInversifyRegister } from './inversify';\nimport { bindNamed, bindGeneralToken, bindMonoToken, bindLifecycle } from './inversify';\nimport { Utils, Syringe } from './core';\nimport { OptionSymbol } from './side-option';\nimport { Container } from './container';\nexport function toRegistryOption(options) {\n  var token = Utils.toArray(options.token);\n  var useClass = Utils.toArray(options.useClass);\n  var useDynamic = Utils.toArray(options.useDynamic);\n  var useFactory = Utils.toArray(options.useFactory);\n  var contrib = Utils.toArray(options.contrib);\n  var lifecycle = options.lifecycle || Syringe.Lifecycle.transient;\n  var generalOption = {\n    token: token,\n    useClass: useClass,\n    lifecycle: contrib.length > 0 ? Syringe.Lifecycle.singleton : lifecycle,\n    contrib: contrib,\n    useDynamic: useDynamic,\n    useFactory: useFactory\n  };\n\n  if ('useValue' in options) {\n    generalOption.useValue = options.useValue;\n  }\n\n  return generalOption;\n}\nexport var Register = /*#__PURE__*/function () {\n  function Register(register, token, option) {\n    _classCallCheck(this, Register);\n\n    this.token = void 0;\n    this.rawToken = void 0;\n    this.named = void 0;\n    this.generalToken = void 0;\n    this.option = void 0;\n    this.register = void 0;\n    this.mutiple = void 0;\n    this.register = register;\n    this.token = token;\n    this.option = option;\n    this.rawToken = Utils.isNamedToken(token) ? token.token : token;\n    this.named = Utils.isNamedToken(token) ? token.named : undefined;\n    this.mutiple = !!this.named || Utils.isMultipleEnabled(this.rawToken);\n    this.generalToken = this.rawToken;\n  }\n  /**\n   * multi or mono register\n   * mono bind 优先级 useValue > useDynamic > useFactory > useClass\n   */\n\n\n  _createClass(Register, [{\n    key: \"resolve\",\n    value: function resolve() {\n      var _this = this;\n\n      var register = this.register;\n\n      if (!isInversifyRegister(register)) {\n        return;\n      }\n\n      if (this.mutiple) {\n        this.resolveMutilple(register);\n      } else {\n        this.resolveMono(register);\n\n        if (!this.named && this.option.contrib.length > 0) {\n          this.option.contrib.forEach(function (contribution) {\n            if (Utils.isMultipleEnabled(contribution)) {\n              bindGeneralToken(contribution, register).toService(_this.generalToken);\n            } else {\n              bindMonoToken(contribution, register).toService(_this.generalToken);\n            }\n          });\n        }\n      }\n    } // eslint-disable-next-line consistent-return\n\n  }, {\n    key: \"resolveMono\",\n    value: function resolveMono(register) {\n      if ('useValue' in this.option) {\n        return bindMonoToken(this.generalToken, register).toConstantValue(this.option.useValue);\n      }\n\n      if (this.option.useDynamic.length > 0) {\n        var dynamic = this.option.useDynamic[this.option.useDynamic.length - 1];\n        return bindLifecycle(bindMonoToken(this.generalToken, register).toDynamicValue(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return dynamic({\n            container: container\n          });\n        }), this.option);\n      }\n\n      if (this.option.useFactory.length > 0) {\n        var factrory = this.option.useFactory[this.option.useFactory.length - 1];\n        return bindMonoToken(this.generalToken, register).toFactory(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return factrory({\n            container: container\n          });\n        });\n      }\n\n      if (this.option.useClass.length > 0) {\n        var newable = this.option.useClass[this.option.useClass.length - 1];\n        return bindLifecycle(bindMonoToken(this.generalToken, register).to(newable), this.option);\n      }\n    }\n  }, {\n    key: \"resolveMutilple\",\n    value: function resolveMutilple(register) {\n      var _this2 = this;\n\n      var classesList = this.option.useClass.map(function (newable) {\n        return bindLifecycle(bindGeneralToken(_this2.generalToken, register).to(newable), _this2.option);\n      });\n      var dynamicList = this.option.useDynamic.map(function (dynamic) {\n        return bindLifecycle(bindGeneralToken(_this2.generalToken, register).toDynamicValue(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return dynamic({\n            container: container\n          });\n        }), _this2.option);\n      });\n      var factoryList = this.option.useFactory.map(function (factrory) {\n        return bindGeneralToken(_this2.generalToken, register).toFactory(function (ctx) {\n          var container = Container.getContainer(ctx.container);\n          return factrory({\n            container: container\n          });\n        });\n      });\n      var valueToBind = 'useValue' in this.option ? bindGeneralToken(this.generalToken, register).toConstantValue(this.option.useValue) : undefined;\n\n      if (this.named) {\n        classesList.forEach(function (tobind) {\n          return _this2.named && bindNamed(tobind, _this2.named);\n        });\n        dynamicList.forEach(function (tobind) {\n          return _this2.named && bindNamed(tobind, _this2.named);\n        });\n        factoryList.forEach(function (tobind) {\n          return _this2.named && bindNamed(tobind, _this2.named);\n        });\n\n        if (valueToBind) {\n          bindNamed(valueToBind, this.named);\n        }\n      }\n    }\n  }], [{\n    key: \"resolveTarget\",\n    value: // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    /**\n     * 注册目标 token，合并 token 配置后基于配置注册\n     */\n    function resolveTarget(register, target) {\n      var option = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      try {\n        try {\n          var sideOption = Reflect.getMetadata(OptionSymbol, target);\n\n          if (sideOption) {\n            Register.resolveOption(register, sideOption);\n          }\n        } catch (ex) {// noop\n        } // 当 target 为类时，将其插入 useClass 配置中\n\n\n        if (Utils.isClass(target)) {\n          if (!option.useClass) {\n            option.useClass = [target];\n          } else {\n            var classes = Utils.toArray(option.useClass);\n            classes.unshift(target);\n            option.useClass = classes;\n          }\n        }\n\n        var mixedOption;\n\n        try {\n          mixedOption = Reflect.getMetadata(Syringe.ClassOptionSymbol, target);\n        } catch (ex) {// noop\n        }\n\n        mixedOption = _objectSpread(_objectSpread({}, mixedOption || {}), option);\n\n        if (!mixedOption.token) {\n          mixedOption.token = [target];\n        } else {\n          var tokens = Utils.toArray(mixedOption.token);\n          tokens.unshift(target);\n          mixedOption.token = tokens;\n        }\n\n        Register.resolveOption(register, mixedOption);\n      } catch (ex) {// noop\n      }\n    }\n    /**\n     * 基于配置注册\n     */\n\n  }, {\n    key: \"resolveOption\",\n    value: function resolveOption(iRegister, baseOption) {\n      var parsedOption = toRegistryOption(_objectSpread(_objectSpread({}, Register.globalConfig), baseOption));\n\n      if (parsedOption.useClass.length === 0 && parsedOption.useDynamic.length === 0 && parsedOption.useFactory.length === 0 && !('useValue' in parsedOption)) {\n        return;\n      }\n\n      parsedOption.token.forEach(function (token) {\n        var register = new Register(iRegister, token, _objectSpread({}, parsedOption));\n        register.resolve();\n      });\n    }\n  }]);\n\n  return Register;\n}();\nRegister.globalConfig = Syringe.DefaultOption;"]},"metadata":{},"sourceType":"module"}