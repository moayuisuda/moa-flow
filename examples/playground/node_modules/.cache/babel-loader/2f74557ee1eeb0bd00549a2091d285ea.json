{"ast":null,"code":"import { __extends, __rest, __assign } from '../node_modules/tslib/tslib.es6.js';\nimport '../node_modules/lodash/lodash.js';\nimport { Group, Path, Line, Polyline } from '@antv/react-g';\nimport React, { Component } from 'react';\nimport { l as lodash } from '../_virtual/lodash.js';\nimport { create, fromValues } from '../node_modules/gl-matrix/esm/vec3.js';\nvar typeMap = {\n  Path: Path,\n  Line: Line,\n  Polyline: Polyline\n};\n/**\n * support 3 types of arrow line:\n * 1. Line\n * 2. Polyline\n * 3. Path\n *\n * support 2 types of arrow head:\n * 1. default(Path)\n * 2. custom\n */\n\nvar Arrow =\n/** @class */\nfunction (_super) {\n  __extends(Arrow, _super);\n\n  function Arrow(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.startRef = React.createRef();\n    _this.endRef = React.createRef();\n    _this.bodyRef = React.createRef();\n    return _this;\n  }\n\n  Arrow.prototype.getArrowHead = function (head, isStart) {\n    if (lodash.exports.isBoolean(head)) {\n      return this.getDefaultArrowHead();\n    } else {\n      return isStart ? this.props.startHead : this.props.endHead;\n    }\n  };\n\n  Arrow.prototype.setHeadTransform = function () {\n    var _a = this.props,\n        startHead = _a.startHead,\n        endHead = _a.endHead;\n    startHead && this.transformArrowHead(this.startRef.current, true);\n    endHead && this.transformArrowHead(this.endRef.current, false);\n  };\n\n  Arrow.prototype.componentDidMount = function () {\n    this.setHeadTransform();\n  };\n\n  Arrow.prototype.componentDidUpdate = function () {\n    this.setHeadTransform();\n  };\n\n  Arrow.prototype.render = function () {\n    var _a = this.props,\n        startHead = _a.startHead,\n        endHead = _a.endHead,\n        others = __rest(_a, [\"startHead\", \"endHead\"]);\n\n    return React.createElement(React.Fragment, null, React.createElement(typeMap[this.props.type], __assign(__assign({}, others), {\n      ref: this.bodyRef\n    })), startHead && React.createElement(Group, {\n      ref: this.startRef\n    }, this.getArrowHead(startHead, true)), endHead && React.createElement(Group, {\n      ref: this.endRef\n    }, this.getArrowHead(endHead, false)));\n  };\n  /**\n   * transform arrow head according to arrow line\n   */\n\n\n  Arrow.prototype.transformArrowHead = function (head, isStart) {\n    var position = create();\n    var rad = 0;\n    var x1 = 0;\n    var x2 = 0;\n    var y1 = 0;\n    var y2 = 0;\n    var bodyType = this.props.type;\n\n    if (bodyType === \"Line\") {\n      var _a = this.bodyRef.current.attributes,\n          _x1 = _a.x1,\n          _x2 = _a.x2,\n          _y1 = _a.y1,\n          _y2 = _a.y2;\n      x1 = isStart ? _x1 : _x2;\n      x2 = isStart ? _x2 : _x1;\n      y1 = isStart ? _y1 : _y2;\n      y2 = isStart ? _y2 : _y1;\n    } else if (bodyType === \"Polyline\") {\n      var points = this.bodyRef.current.attributes.points;\n      var length_1 = points.length;\n      x1 = isStart ? points[1][0] : points[length_1 - 2][0];\n      y1 = isStart ? points[1][1] : points[length_1 - 2][1];\n      x2 = isStart ? points[0][0] : points[length_1 - 1][0];\n      y2 = isStart ? points[0][1] : points[length_1 - 1][1];\n    } else if (bodyType === \"Path\") {\n      var _b = this.getTangent(this.bodyRef.current, isStart),\n          p1 = _b[0],\n          p2 = _b[1];\n\n      x1 = p1[0];\n      y1 = p1[1];\n      x2 = p2[0];\n      y2 = p2[1];\n    }\n\n    var x = x1 - x2;\n    var y = y1 - y2;\n    rad = Math.atan2(y, x);\n    position = fromValues(x2, y2, 0);\n    head.setLocalPosition(position);\n    head.style.transform = \"rotate(\".concat(rad * 180 / Math.PI, \"deg)\");\n  };\n\n  Arrow.prototype.getTangent = function (path, isStart) {\n    return isStart ? path.getStartTangent() : path.getEndTangent();\n  };\n\n  Arrow.prototype.getDefaultArrowHead = function () {\n    var _a = this.props;\n    _a.startHead;\n    _a.endHead;\n    _a.body;\n\n    var others = __rest(_a, [\"startHead\", \"endHead\", \"body\"]);\n\n    var sin = Math.sin,\n        cos = Math.cos,\n        PI = Math.PI;\n    return React.createElement(Path, __assign({}, others, {\n      fill: this.props.stroke,\n      path: \"M\".concat(10 * cos(PI / 6), \",\").concat(10 * sin(PI / 6), \" L0,0 L\").concat(10 * cos(PI / 6), \",-\").concat(10 * sin(PI / 6), \" Z\")\n    }));\n  };\n\n  return Arrow;\n}(Component);\n\nexport { Arrow as default };","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/packages/flow/lib/components/Arrow.js"],"names":["__extends","__rest","__assign","Group","Path","Line","Polyline","React","Component","l","lodash","create","fromValues","typeMap","Arrow","_super","props","_this","call","startRef","createRef","endRef","bodyRef","prototype","getArrowHead","head","isStart","exports","isBoolean","getDefaultArrowHead","startHead","endHead","setHeadTransform","_a","transformArrowHead","current","componentDidMount","componentDidUpdate","render","others","createElement","Fragment","type","ref","position","rad","x1","x2","y1","y2","bodyType","attributes","_x1","_x2","_y1","_y2","points","length_1","length","_b","getTangent","p1","p2","x","y","Math","atan2","setLocalPosition","style","transform","concat","PI","path","getStartTangent","getEndTangent","body","sin","cos","fill","stroke","default"],"mappings":"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","sourcesContent":["import { __extends, __rest, __assign } from '../node_modules/tslib/tslib.es6.js';\nimport '../node_modules/lodash/lodash.js';\nimport { Group, Path, Line, Polyline } from '@antv/react-g';\nimport React, { Component } from 'react';\nimport { l as lodash } from '../_virtual/lodash.js';\nimport { create, fromValues } from '../node_modules/gl-matrix/esm/vec3.js';\n\nvar typeMap = {\n    Path: Path,\n    Line: Line,\n    Polyline: Polyline,\n};\n/**\n * support 3 types of arrow line:\n * 1. Line\n * 2. Polyline\n * 3. Path\n *\n * support 2 types of arrow head:\n * 1. default(Path)\n * 2. custom\n */\nvar Arrow = /** @class */ (function (_super) {\n    __extends(Arrow, _super);\n    function Arrow(props) {\n        var _this = _super.call(this, props) || this;\n        _this.startRef = React.createRef();\n        _this.endRef = React.createRef();\n        _this.bodyRef = React.createRef();\n        return _this;\n    }\n    Arrow.prototype.getArrowHead = function (head, isStart) {\n        if (lodash.exports.isBoolean(head)) {\n            return this.getDefaultArrowHead();\n        }\n        else {\n            return isStart ? this.props.startHead : this.props.endHead;\n        }\n    };\n    Arrow.prototype.setHeadTransform = function () {\n        var _a = this.props, startHead = _a.startHead, endHead = _a.endHead;\n        startHead &&\n            this.transformArrowHead(this.startRef.current, true);\n        endHead &&\n            this.transformArrowHead(this.endRef.current, false);\n    };\n    Arrow.prototype.componentDidMount = function () {\n        this.setHeadTransform();\n    };\n    Arrow.prototype.componentDidUpdate = function () {\n        this.setHeadTransform();\n    };\n    Arrow.prototype.render = function () {\n        var _a = this.props, startHead = _a.startHead, endHead = _a.endHead, others = __rest(_a, [\"startHead\", \"endHead\"]);\n        return (React.createElement(React.Fragment, null,\n            React.createElement(typeMap[this.props.type], __assign(__assign({}, others), { ref: this.bodyRef })),\n            startHead && (React.createElement(Group, { ref: this.startRef }, this.getArrowHead(startHead, true))),\n            endHead && (React.createElement(Group, { ref: this.endRef }, this.getArrowHead(endHead, false)))));\n    };\n    /**\n     * transform arrow head according to arrow line\n     */\n    Arrow.prototype.transformArrowHead = function (head, isStart) {\n        var position = create();\n        var rad = 0;\n        var x1 = 0;\n        var x2 = 0;\n        var y1 = 0;\n        var y2 = 0;\n        var bodyType = this.props.type;\n        if (bodyType === \"Line\") {\n            var _a = this.bodyRef.current.attributes, _x1 = _a.x1, _x2 = _a.x2, _y1 = _a.y1, _y2 = _a.y2;\n            x1 = isStart ? _x1 : _x2;\n            x2 = isStart ? _x2 : _x1;\n            y1 = isStart ? _y1 : _y2;\n            y2 = isStart ? _y2 : _y1;\n        }\n        else if (bodyType === \"Polyline\") {\n            var points = this.bodyRef.current.attributes.points;\n            var length_1 = points.length;\n            x1 = isStart ? points[1][0] : points[length_1 - 2][0];\n            y1 = isStart ? points[1][1] : points[length_1 - 2][1];\n            x2 = isStart ? points[0][0] : points[length_1 - 1][0];\n            y2 = isStart ? points[0][1] : points[length_1 - 1][1];\n        }\n        else if (bodyType === \"Path\") {\n            var _b = this.getTangent(this.bodyRef.current, isStart), p1 = _b[0], p2 = _b[1];\n            x1 = p1[0];\n            y1 = p1[1];\n            x2 = p2[0];\n            y2 = p2[1];\n        }\n        var x = x1 - x2;\n        var y = y1 - y2;\n        rad = Math.atan2(y, x);\n        position = fromValues(x2, y2, 0);\n        head.setLocalPosition(position);\n        head.style.transform = \"rotate(\".concat((rad * 180) / Math.PI, \"deg)\");\n    };\n    Arrow.prototype.getTangent = function (path, isStart) {\n        return isStart ? path.getStartTangent() : path.getEndTangent();\n    };\n    Arrow.prototype.getDefaultArrowHead = function () {\n        var _a = this.props; _a.startHead; _a.endHead; _a.body; var others = __rest(_a, [\"startHead\", \"endHead\", \"body\"]);\n        var sin = Math.sin, cos = Math.cos, PI = Math.PI;\n        return (React.createElement(Path, __assign({}, others, { fill: this.props.stroke, path: \"M\".concat(10 * cos(PI / 6), \",\").concat(10 * sin(PI / 6), \" L0,0 L\").concat(10 * cos(PI / 6), \",-\").concat(10 * sin(PI / 6), \" Z\") })));\n    };\n    return Arrow;\n}(Component));\n\nexport { Arrow as default };\n"]},"metadata":{},"sourceType":"module"}