{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\nimport { inject, singleton } from 'mana-syringe';\nimport { StyleValueRegistry } from '../css';\nimport { ElementEvent } from '../dom';\nimport { RenderingContext, RenderingPluginContribution, dirtifyToRoot } from '../services';\n\nvar PrepareRendererPlugin =\n/** @class */\nfunction () {\n  function PrepareRendererPlugin() {}\n\n  PrepareRendererPlugin_1 = PrepareRendererPlugin;\n\n  PrepareRendererPlugin.prototype.apply = function (renderingService) {\n    var _this = this;\n\n    var handleAttributeChanged = function handleAttributeChanged(e) {\n      // this.renderingContext.renderReasons.add(RenderReason.DISPLAY_OBJECT_CHANGED);\n      var object = e.target;\n      object.renderable.dirty = true;\n      renderingService.dirtify();\n    };\n\n    var handleBoundsChanged = function handleBoundsChanged() {\n      renderingService.dirtify();\n    };\n\n    var handleMounted = function handleMounted(e) {\n      var object = e.target; // recalc style values\n\n      _this.styleValueRegistry.recalc(object);\n\n      dirtifyToRoot(object);\n      renderingService.dirtify();\n    };\n\n    var handleUnmounted = function handleUnmounted(e) {\n      dirtifyToRoot(e.target);\n      renderingService.dirtify();\n    };\n\n    renderingService.hooks.init.tap(PrepareRendererPlugin_1.tag, function () {\n      _this.renderingContext.root.addEventListener(ElementEvent.MOUNTED, handleMounted);\n\n      _this.renderingContext.root.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n\n      _this.renderingContext.root.addEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n\n      _this.renderingContext.root.addEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n    });\n    renderingService.hooks.destroy.tap(PrepareRendererPlugin_1.tag, function () {\n      _this.renderingContext.root.removeEventListener(ElementEvent.MOUNTED, handleMounted);\n\n      _this.renderingContext.root.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n\n      _this.renderingContext.root.removeEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n\n      _this.renderingContext.root.removeEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n    });\n  };\n\n  var PrepareRendererPlugin_1;\n  PrepareRendererPlugin.tag = 'PrepareRendererPlugin';\n\n  __decorate([inject(RenderingContext), __metadata(\"design:type\", Object)], PrepareRendererPlugin.prototype, \"renderingContext\", void 0);\n\n  __decorate([inject(StyleValueRegistry), __metadata(\"design:type\", StyleValueRegistry)], PrepareRendererPlugin.prototype, \"styleValueRegistry\", void 0);\n\n  PrepareRendererPlugin = PrepareRendererPlugin_1 = __decorate([singleton({\n    contrib: RenderingPluginContribution\n  })], PrepareRendererPlugin);\n  return PrepareRendererPlugin;\n}();\n\nexport { PrepareRendererPlugin };","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/@antv/g/es/plugins/PrepareRendererPlugin.js"],"names":["__decorate","__metadata","inject","singleton","StyleValueRegistry","ElementEvent","RenderingContext","RenderingPluginContribution","dirtifyToRoot","PrepareRendererPlugin","PrepareRendererPlugin_1","prototype","apply","renderingService","_this","handleAttributeChanged","e","object","target","renderable","dirty","dirtify","handleBoundsChanged","handleMounted","styleValueRegistry","recalc","handleUnmounted","hooks","init","tap","tag","renderingContext","root","addEventListener","MOUNTED","UNMOUNTED","ATTR_MODIFIED","BOUNDS_CHANGED","destroy","removeEventListener","Object","contrib"],"mappings":"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","sourcesContent":["import { __decorate, __metadata } from \"tslib\";\nimport { inject, singleton } from 'mana-syringe';\nimport { StyleValueRegistry } from '../css';\nimport { ElementEvent } from '../dom';\nimport { RenderingContext, RenderingPluginContribution, dirtifyToRoot } from '../services';\n\nvar PrepareRendererPlugin =\n/** @class */\nfunction () {\n  function PrepareRendererPlugin() {}\n\n  PrepareRendererPlugin_1 = PrepareRendererPlugin;\n\n  PrepareRendererPlugin.prototype.apply = function (renderingService) {\n    var _this = this;\n\n    var handleAttributeChanged = function handleAttributeChanged(e) {\n      // this.renderingContext.renderReasons.add(RenderReason.DISPLAY_OBJECT_CHANGED);\n      var object = e.target;\n      object.renderable.dirty = true;\n      renderingService.dirtify();\n    };\n\n    var handleBoundsChanged = function handleBoundsChanged() {\n      renderingService.dirtify();\n    };\n\n    var handleMounted = function handleMounted(e) {\n      var object = e.target; // recalc style values\n\n      _this.styleValueRegistry.recalc(object);\n\n      dirtifyToRoot(object);\n      renderingService.dirtify();\n    };\n\n    var handleUnmounted = function handleUnmounted(e) {\n      dirtifyToRoot(e.target);\n      renderingService.dirtify();\n    };\n\n    renderingService.hooks.init.tap(PrepareRendererPlugin_1.tag, function () {\n      _this.renderingContext.root.addEventListener(ElementEvent.MOUNTED, handleMounted);\n\n      _this.renderingContext.root.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n\n      _this.renderingContext.root.addEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n\n      _this.renderingContext.root.addEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n    });\n    renderingService.hooks.destroy.tap(PrepareRendererPlugin_1.tag, function () {\n      _this.renderingContext.root.removeEventListener(ElementEvent.MOUNTED, handleMounted);\n\n      _this.renderingContext.root.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n\n      _this.renderingContext.root.removeEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n\n      _this.renderingContext.root.removeEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n    });\n  };\n\n  var PrepareRendererPlugin_1;\n  PrepareRendererPlugin.tag = 'PrepareRendererPlugin';\n\n  __decorate([inject(RenderingContext), __metadata(\"design:type\", Object)], PrepareRendererPlugin.prototype, \"renderingContext\", void 0);\n\n  __decorate([inject(StyleValueRegistry), __metadata(\"design:type\", StyleValueRegistry)], PrepareRendererPlugin.prototype, \"styleValueRegistry\", void 0);\n\n  PrepareRendererPlugin = PrepareRendererPlugin_1 = __decorate([singleton({\n    contrib: RenderingPluginContribution\n  })], PrepareRendererPlugin);\n  return PrepareRendererPlugin;\n}();\n\nexport { PrepareRendererPlugin };"]},"metadata":{},"sourceType":"module"}