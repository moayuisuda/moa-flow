{"ast":null,"code":"import { __extends } from '../node_modules/tslib/tslib.es6.js';\nimport { Group } from '@antv/react-g';\nimport React from 'react';\nimport Cell from '../cells/Cell.js';\nimport '../node_modules/lodash/lodash.js';\nimport { l as lodash } from '../_virtual/lodash.js';\n\nvar Port =\n/** @class */\nfunction (_super) {\n  __extends(Port, _super);\n\n  function Port(props, context) {\n    return _super.call(this, props, context) || this;\n  }\n\n  Port.prototype.anchor = function () {\n    return lodash.exports.isFunction(this.props.anchor) ? this.props.anchor() : this.props.anchor;\n  };\n\n  Port.prototype.onLinkStart = function (e) {\n    e.stopPropagation();\n    var link = this.context.buffer.link;\n    this.context.sendEvent({\n      type: \"beforeLink\",\n      data: {\n        source: this.props.data.id\n      }\n    });\n    link.source = this.props.data.id;\n    link.target = this.anchor();\n  };\n\n  Port.prototype.onLinkEnd = function (e) {\n    e.stopPropagation();\n\n    var _a = this,\n        context = _a.context,\n        link = _a.context.buffer.link;\n\n    var sourceInstance = context.cellsMap.get(link.source);\n\n    if (link.source === this.props.data.id) {\n      context.clearLinkBuffer();\n    } else if (this.props.link || sourceInstance.props.link) {\n      var adoptSource = true;\n      var adoptTarget = true;\n      var sourceData = context.getCellData(link.source);\n\n      if (sourceInstance.props.link) {\n        if (sourceInstance.props.link(sourceData, this.props.data)) adoptSource = true;else adoptSource = false;\n      }\n\n      if (this.props.link) {\n        if (this.props.link(sourceData, this.props.data)) adoptTarget = true;else adoptTarget = false;\n      }\n\n      if (adoptSource && adoptTarget) context.link(link.source, this.props.data.id);else context.clearLinkBuffer();\n    } else {\n      context.link(link.source, this.props.data.id);\n    }\n  };\n\n  Port.prototype.content = function () {\n    var _this = this;\n\n    return React.createElement(Group, {\n      onMousedown: function (e) {\n        return _this.onLinkStart(e);\n      },\n      onMouseup: function (e) {\n        return _this.onLinkEnd(e);\n      },\n      x: this.props.x || 0,\n      y: this.props.y || 0\n    }, this.props.children);\n  };\n\n  Port.metaData = {\n    cellType: \"port\",\n    source: undefined,\n    target: undefined\n  };\n  return Port;\n}(Cell);\n\nexport { Port as default };","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/packages/flow/lib/scaffold/Port.js"],"names":["__extends","Group","React","Cell","l","lodash","Port","_super","props","context","call","prototype","anchor","exports","isFunction","onLinkStart","e","stopPropagation","link","buffer","sendEvent","type","data","source","id","target","onLinkEnd","_a","sourceInstance","cellsMap","get","clearLinkBuffer","adoptSource","adoptTarget","sourceData","getCellData","content","_this","createElement","onMousedown","onMouseup","x","y","children","metaData","cellType","undefined","default"],"mappings":"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","sourcesContent":["import { __extends } from '../node_modules/tslib/tslib.es6.js';\nimport { Group } from '@antv/react-g';\nimport React from 'react';\nimport Cell from '../cells/Cell.js';\nimport '../node_modules/lodash/lodash.js';\nimport { l as lodash } from '../_virtual/lodash.js';\n\nvar Port = /** @class */ (function (_super) {\n    __extends(Port, _super);\n    function Port(props, context) {\n        return _super.call(this, props, context) || this;\n    }\n    Port.prototype.anchor = function () {\n        return lodash.exports.isFunction(this.props.anchor)\n            ? this.props.anchor()\n            : this.props.anchor;\n    };\n    Port.prototype.onLinkStart = function (e) {\n        e.stopPropagation();\n        var link = this.context.buffer.link;\n        this.context.sendEvent({\n            type: \"beforeLink\",\n            data: {\n                source: this.props.data.id,\n            },\n        });\n        link.source = this.props.data.id;\n        link.target = this.anchor();\n    };\n    Port.prototype.onLinkEnd = function (e) {\n        e.stopPropagation();\n        var _a = this, context = _a.context, link = _a.context.buffer.link;\n        var sourceInstance = context.cellsMap.get(link.source);\n        if (link.source === this.props.data.id) {\n            context.clearLinkBuffer();\n        }\n        else if (this.props.link || sourceInstance.props.link) {\n            var adoptSource = true;\n            var adoptTarget = true;\n            var sourceData = context.getCellData(link.source);\n            if (sourceInstance.props.link) {\n                if (sourceInstance.props.link(sourceData, this.props.data))\n                    adoptSource = true;\n                else\n                    adoptSource = false;\n            }\n            if (this.props.link) {\n                if (this.props.link(sourceData, this.props.data))\n                    adoptTarget = true;\n                else\n                    adoptTarget = false;\n            }\n            if (adoptSource && adoptTarget)\n                context.link(link.source, this.props.data.id);\n            else\n                context.clearLinkBuffer();\n        }\n        else {\n            context.link(link.source, this.props.data.id);\n        }\n    };\n    Port.prototype.content = function () {\n        var _this = this;\n        return (React.createElement(Group, { onMousedown: function (e) { return _this.onLinkStart(e); }, onMouseup: function (e) { return _this.onLinkEnd(e); }, x: this.props.x || 0, y: this.props.y || 0 }, this.props.children));\n    };\n    Port.metaData = {\n        cellType: \"port\",\n        source: undefined,\n        target: undefined,\n    };\n    return Port;\n}(Cell));\n\nexport { Port as default };\n"]},"metadata":{},"sourceType":"module"}