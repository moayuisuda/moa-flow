{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { Node } from './Node';\nimport { AnimationTimeline } from './AnimationTimeline';\nimport { Group, Text } from '../display-objects';\nimport { BUILT_IN_PROPERTIES } from '../css';\n/**\n * the entry of DOM tree\n * Document -> Node -> EventTarget\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document\n */\n\nvar Document =\n/** @class */\nfunction (_super) {\n  __extends(Document, _super);\n\n  function Document() {\n    var _this = _super.call(this) || this;\n    /**\n     * only document has defaultView, points to canvas,\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/defaultView\n     */\n\n\n    _this.defaultView = null;\n    _this.ownerDocument = null;\n    _this.nodeName = 'document'; // create timeline\n\n    _this.timeline = new AnimationTimeline(_this);\n    /**\n     * for inherited properties, the initial value is used on the root element only,\n     * as long as no specified value is supplied.\n     * @see https://developer.mozilla.org/en-US/docs/Web/CSS/initial_value\n     */\n\n    var initialStyle = {};\n    BUILT_IN_PROPERTIES.forEach(function (_a) {\n      var name = _a.name,\n          inherited = _a.inherited,\n          defaultValue = _a.defaultValue;\n\n      if (inherited && defaultValue) {\n        initialStyle[name] = defaultValue;\n      }\n    }); // like <html> in DOM tree\n\n    _this.documentElement = new Group({\n      id: 'g-root',\n      style: initialStyle\n    });\n    _this.documentElement.ownerDocument = _this;\n    _this.documentElement.parentNode = _this;\n    _this.childNodes = [_this.documentElement];\n    return _this;\n  }\n\n  Object.defineProperty(Document.prototype, \"children\", {\n    get: function get() {\n      return this.childNodes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Document.prototype, \"childElementCount\", {\n    get: function get() {\n      return this.childNodes.length;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Document.prototype, \"firstElementChild\", {\n    get: function get() {\n      return this.firstChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Document.prototype, \"lastElementChild\", {\n    get: function get() {\n      return this.lastChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * @example const circle = document.createElement('circle', { style: { r: 10 } });\n   */\n\n  Document.prototype.createElement = function (tagName, options) {\n    // d3 will use <tspan>\n    var clazz = this.defaultView.customElements.get(tagName);\n\n    if (!clazz) {\n      console.warn('Unsupported tagName: ', tagName);\n      clazz = tagName === 'tspan' ? Text : Group;\n    }\n\n    return new clazz(options);\n  };\n\n  Document.prototype.createElementNS = function (namespaceURI, tagName, options) {\n    return this.createElement(tagName, options);\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.cloneNode = function (deep) {\n    throw new Error('Method not implemented.');\n  };\n\n  Document.prototype.destroy = function () {\n    try {\n      this.documentElement.destroy();\n    } catch (e) {}\n\n    this.timeline.destroy();\n  };\n  /**\n   * Do picking with API instead of triggering interactive events.\n   *\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementFromPoint\n   */\n\n\n  Document.prototype.elementFromPoint = function (x, y) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, viewportX, viewportY, _b, width, height, _c, clientX, clientY, picked;\n\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            _a = this.defaultView.canvas2Viewport({\n              x: x,\n              y: y\n            }), viewportX = _a.x, viewportY = _a.y;\n            _b = this.defaultView.getConfig(), width = _b.width, height = _b.height; // outside canvas' viewport\n\n            if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n              return [2\n              /*return*/\n              , null];\n            }\n\n            _c = this.defaultView.viewport2Client({\n              x: viewportX,\n              y: viewportY\n            }), clientX = _c.x, clientY = _c.y;\n            return [4\n            /*yield*/\n            , this.defaultView.getRenderingService().hooks.pick.promise({\n              topmost: true,\n              position: {\n                x: x,\n                y: y,\n                viewportX: viewportX,\n                viewportY: viewportY,\n                clientX: clientX,\n                clientY: clientY\n              },\n              picked: []\n            })];\n\n          case 1:\n            picked = _d.sent().picked;\n            return [2\n            /*return*/\n            , picked && picked[0] || this.documentElement];\n        }\n      });\n    });\n  };\n  /**\n   * Do picking with API instead of triggering interactive events.\n   *\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint\n   */\n\n\n  Document.prototype.elementsFromPoint = function (x, y) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, viewportX, viewportY, _b, width, height, _c, clientX, clientY, picked;\n\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            _a = this.defaultView.canvas2Viewport({\n              x: x,\n              y: y\n            }), viewportX = _a.x, viewportY = _a.y;\n            _b = this.defaultView.getConfig(), width = _b.width, height = _b.height; // outside canvas' viewport\n\n            if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n              return [2\n              /*return*/\n              , []];\n            }\n\n            _c = this.defaultView.viewport2Client({\n              x: viewportX,\n              y: viewportY\n            }), clientX = _c.x, clientY = _c.y;\n            return [4\n            /*yield*/\n            , this.defaultView.getRenderingService().hooks.pick.promise({\n              topmost: false,\n              position: {\n                x: x,\n                y: y,\n                viewportX: viewportX,\n                viewportY: viewportY,\n                clientX: clientX,\n                clientY: clientY\n              },\n              picked: []\n            })];\n\n          case 1:\n            picked = _d.sent().picked;\n\n            if (picked[picked.length - 1] !== this.documentElement) {\n              picked.push(this.documentElement);\n            }\n\n            return [2\n            /*return*/\n            , picked];\n        }\n      });\n    });\n  };\n  /**\n   * eg. Uncaught DOMException: Failed to execute 'appendChild' on 'Node': Only one element on document allowed.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.appendChild = function (newChild, index) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.insertBefore = function (newChild, refChild) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.removeChild = function (oldChild, destroy) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.replaceChild = function (newChild, oldChild, destroy) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.append = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.prepend = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    throw new Error('Use document.documentElement instead.');\n  };\n  /**\n   * Execute query on documentElement.\n   */\n\n\n  Document.prototype.getElementById = function (id) {\n    return this.documentElement.getElementById(id);\n  };\n\n  Document.prototype.getElementsByName = function (name) {\n    return this.documentElement.getElementsByName(name);\n  };\n\n  Document.prototype.getElementsByTagName = function (tagName) {\n    return this.documentElement.getElementsByTagName(tagName);\n  };\n\n  Document.prototype.getElementsByClassName = function (className) {\n    return this.documentElement.getElementsByClassName(className);\n  };\n\n  Document.prototype.querySelector = function (selectors) {\n    return this.documentElement.querySelector(selectors);\n  };\n\n  Document.prototype.querySelectorAll = function (selectors) {\n    return this.documentElement.querySelectorAll(selectors);\n  };\n\n  Document.prototype.find = function (filter) {\n    return this.documentElement.find(filter);\n  };\n\n  Document.prototype.findAll = function (filter) {\n    return this.documentElement.findAll(filter);\n  };\n\n  return Document;\n}(Node);\n\nexport { Document };","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/@antv/g/es/dom/Document.js"],"names":["__awaiter","__extends","__generator","Node","AnimationTimeline","Group","Text","BUILT_IN_PROPERTIES","Document","_super","_this","call","defaultView","ownerDocument","nodeName","timeline","initialStyle","forEach","_a","name","inherited","defaultValue","documentElement","id","style","parentNode","childNodes","Object","defineProperty","prototype","get","enumerable","configurable","length","firstChild","lastChild","createElement","tagName","options","clazz","customElements","console","warn","createElementNS","namespaceURI","cloneNode","deep","Error","destroy","e","elementFromPoint","x","y","viewportX","viewportY","_b","width","height","_c","clientX","clientY","picked","_d","label","canvas2Viewport","getConfig","viewport2Client","getRenderingService","hooks","pick","promise","topmost","position","sent","elementsFromPoint","push","appendChild","newChild","index","insertBefore","refChild","removeChild","oldChild","replaceChild","append","nodes","_i","arguments","prepend","getElementById","getElementsByName","getElementsByTagName","getElementsByClassName","className","querySelector","selectors","querySelectorAll","find","filter","findAll"],"mappings":"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","sourcesContent":["import { __awaiter, __extends, __generator } from \"tslib\";\nimport { Node } from './Node';\nimport { AnimationTimeline } from './AnimationTimeline';\nimport { Group, Text } from '../display-objects';\nimport { BUILT_IN_PROPERTIES } from '../css';\n/**\n * the entry of DOM tree\n * Document -> Node -> EventTarget\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document\n */\n\nvar Document =\n/** @class */\nfunction (_super) {\n  __extends(Document, _super);\n\n  function Document() {\n    var _this = _super.call(this) || this;\n    /**\n     * only document has defaultView, points to canvas,\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/defaultView\n     */\n\n\n    _this.defaultView = null;\n    _this.ownerDocument = null;\n    _this.nodeName = 'document'; // create timeline\n\n    _this.timeline = new AnimationTimeline(_this);\n    /**\n     * for inherited properties, the initial value is used on the root element only,\n     * as long as no specified value is supplied.\n     * @see https://developer.mozilla.org/en-US/docs/Web/CSS/initial_value\n     */\n\n    var initialStyle = {};\n    BUILT_IN_PROPERTIES.forEach(function (_a) {\n      var name = _a.name,\n          inherited = _a.inherited,\n          defaultValue = _a.defaultValue;\n\n      if (inherited && defaultValue) {\n        initialStyle[name] = defaultValue;\n      }\n    }); // like <html> in DOM tree\n\n    _this.documentElement = new Group({\n      id: 'g-root',\n      style: initialStyle\n    });\n    _this.documentElement.ownerDocument = _this;\n    _this.documentElement.parentNode = _this;\n    _this.childNodes = [_this.documentElement];\n    return _this;\n  }\n\n  Object.defineProperty(Document.prototype, \"children\", {\n    get: function get() {\n      return this.childNodes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Document.prototype, \"childElementCount\", {\n    get: function get() {\n      return this.childNodes.length;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Document.prototype, \"firstElementChild\", {\n    get: function get() {\n      return this.firstChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Document.prototype, \"lastElementChild\", {\n    get: function get() {\n      return this.lastChild;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * @example const circle = document.createElement('circle', { style: { r: 10 } });\n   */\n\n  Document.prototype.createElement = function (tagName, options) {\n    // d3 will use <tspan>\n    var clazz = this.defaultView.customElements.get(tagName);\n\n    if (!clazz) {\n      console.warn('Unsupported tagName: ', tagName);\n      clazz = tagName === 'tspan' ? Text : Group;\n    }\n\n    return new clazz(options);\n  };\n\n  Document.prototype.createElementNS = function (namespaceURI, tagName, options) {\n    return this.createElement(tagName, options);\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.cloneNode = function (deep) {\n    throw new Error('Method not implemented.');\n  };\n\n  Document.prototype.destroy = function () {\n    try {\n      this.documentElement.destroy();\n    } catch (e) {}\n\n    this.timeline.destroy();\n  };\n  /**\n   * Do picking with API instead of triggering interactive events.\n   *\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementFromPoint\n   */\n\n\n  Document.prototype.elementFromPoint = function (x, y) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, viewportX, viewportY, _b, width, height, _c, clientX, clientY, picked;\n\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            _a = this.defaultView.canvas2Viewport({\n              x: x,\n              y: y\n            }), viewportX = _a.x, viewportY = _a.y;\n            _b = this.defaultView.getConfig(), width = _b.width, height = _b.height; // outside canvas' viewport\n\n            if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n              return [2\n              /*return*/\n              , null];\n            }\n\n            _c = this.defaultView.viewport2Client({\n              x: viewportX,\n              y: viewportY\n            }), clientX = _c.x, clientY = _c.y;\n            return [4\n            /*yield*/\n            , this.defaultView.getRenderingService().hooks.pick.promise({\n              topmost: true,\n              position: {\n                x: x,\n                y: y,\n                viewportX: viewportX,\n                viewportY: viewportY,\n                clientX: clientX,\n                clientY: clientY\n              },\n              picked: []\n            })];\n\n          case 1:\n            picked = _d.sent().picked;\n            return [2\n            /*return*/\n            , picked && picked[0] || this.documentElement];\n        }\n      });\n    });\n  };\n  /**\n   * Do picking with API instead of triggering interactive events.\n   *\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint\n   */\n\n\n  Document.prototype.elementsFromPoint = function (x, y) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, viewportX, viewportY, _b, width, height, _c, clientX, clientY, picked;\n\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            _a = this.defaultView.canvas2Viewport({\n              x: x,\n              y: y\n            }), viewportX = _a.x, viewportY = _a.y;\n            _b = this.defaultView.getConfig(), width = _b.width, height = _b.height; // outside canvas' viewport\n\n            if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n              return [2\n              /*return*/\n              , []];\n            }\n\n            _c = this.defaultView.viewport2Client({\n              x: viewportX,\n              y: viewportY\n            }), clientX = _c.x, clientY = _c.y;\n            return [4\n            /*yield*/\n            , this.defaultView.getRenderingService().hooks.pick.promise({\n              topmost: false,\n              position: {\n                x: x,\n                y: y,\n                viewportX: viewportX,\n                viewportY: viewportY,\n                clientX: clientX,\n                clientY: clientY\n              },\n              picked: []\n            })];\n\n          case 1:\n            picked = _d.sent().picked;\n\n            if (picked[picked.length - 1] !== this.documentElement) {\n              picked.push(this.documentElement);\n            }\n\n            return [2\n            /*return*/\n            , picked];\n        }\n      });\n    });\n  };\n  /**\n   * eg. Uncaught DOMException: Failed to execute 'appendChild' on 'Node': Only one element on document allowed.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.appendChild = function (newChild, index) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.insertBefore = function (newChild, refChild) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.removeChild = function (oldChild, destroy) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.replaceChild = function (newChild, oldChild, destroy) {\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.append = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    throw new Error('Use document.documentElement instead.');\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Document.prototype.prepend = function () {\n    var nodes = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      nodes[_i] = arguments[_i];\n    }\n\n    throw new Error('Use document.documentElement instead.');\n  };\n  /**\n   * Execute query on documentElement.\n   */\n\n\n  Document.prototype.getElementById = function (id) {\n    return this.documentElement.getElementById(id);\n  };\n\n  Document.prototype.getElementsByName = function (name) {\n    return this.documentElement.getElementsByName(name);\n  };\n\n  Document.prototype.getElementsByTagName = function (tagName) {\n    return this.documentElement.getElementsByTagName(tagName);\n  };\n\n  Document.prototype.getElementsByClassName = function (className) {\n    return this.documentElement.getElementsByClassName(className);\n  };\n\n  Document.prototype.querySelector = function (selectors) {\n    return this.documentElement.querySelector(selectors);\n  };\n\n  Document.prototype.querySelectorAll = function (selectors) {\n    return this.documentElement.querySelectorAll(selectors);\n  };\n\n  Document.prototype.find = function (filter) {\n    return this.documentElement.find(filter);\n  };\n\n  Document.prototype.findAll = function (filter) {\n    return this.documentElement.findAll(filter);\n  };\n\n  return Document;\n}(Node);\n\nexport { Document };"]},"metadata":{},"sourceType":"module"}