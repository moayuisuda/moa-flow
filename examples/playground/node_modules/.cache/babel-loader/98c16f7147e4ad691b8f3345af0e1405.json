{"ast":null,"code":"import { vec3 } from 'gl-matrix';\n/**\n * Axis-Aligned Bounding Box\n * 为了便于后续 Frustum Culling，通过查找表定义 p-vertex 和 n-vertex\n * @see https://github.com/antvis/GWebGPUEngine/issues/3\n */\n\nvar AABB =\n/** @class */\nfunction () {\n  function AABB(center, halfExtents) {\n    this.min = vec3.create();\n    this.max = vec3.create();\n    this.update(center, halfExtents);\n  }\n\n  AABB.isEmpty = function (aabb) {\n    return !aabb || aabb.halfExtents[0] === 0 && aabb.halfExtents[1] === 0 && aabb.halfExtents[2] === 0;\n  };\n\n  AABB.prototype.update = function (center, halfExtents) {\n    this.center = vec3.copy(vec3.create(), center || vec3.create());\n    this.halfExtents = vec3.copy(vec3.create(), halfExtents || vec3.fromValues(0, 0, 0));\n    this.min = vec3.sub(this.min, this.center, this.halfExtents);\n    this.max = vec3.add(this.max, this.center, this.halfExtents);\n  };\n\n  AABB.prototype.setMinMax = function (min, max) {\n    vec3.add(this.center, max, min);\n    vec3.scale(this.center, this.center, 0.5);\n    vec3.sub(this.halfExtents, max, min);\n    vec3.scale(this.halfExtents, this.halfExtents, 0.5);\n    vec3.copy(this.min, min);\n    vec3.copy(this.max, max);\n  };\n\n  AABB.prototype.getMin = function () {\n    return this.min;\n  };\n\n  AABB.prototype.getMax = function () {\n    return this.max;\n  };\n\n  AABB.prototype.add = function (aabb) {\n    if (AABB.isEmpty(aabb)) {\n      return;\n    }\n\n    if (AABB.isEmpty(this)) {\n      this.setMinMax(aabb.getMin(), aabb.getMax());\n      return;\n    }\n\n    var tc = this.center;\n    var tcx = tc[0];\n    var tcy = tc[1];\n    var tcz = tc[2];\n    var th = this.halfExtents;\n    var thx = th[0];\n    var thy = th[1];\n    var thz = th[2];\n    var tminx = tcx - thx;\n    var tmaxx = tcx + thx;\n    var tminy = tcy - thy;\n    var tmaxy = tcy + thy;\n    var tminz = tcz - thz;\n    var tmaxz = tcz + thz;\n    var oc = aabb.center;\n    var ocx = oc[0];\n    var ocy = oc[1];\n    var ocz = oc[2];\n    var oh = aabb.halfExtents;\n    var ohx = oh[0];\n    var ohy = oh[1];\n    var ohz = oh[2];\n    var ominx = ocx - ohx;\n    var omaxx = ocx + ohx;\n    var ominy = ocy - ohy;\n    var omaxy = ocy + ohy;\n    var ominz = ocz - ohz;\n    var omaxz = ocz + ohz;\n\n    if (ominx < tminx) {\n      tminx = ominx;\n    }\n\n    if (omaxx > tmaxx) {\n      tmaxx = omaxx;\n    }\n\n    if (ominy < tminy) {\n      tminy = ominy;\n    }\n\n    if (omaxy > tmaxy) {\n      tmaxy = omaxy;\n    }\n\n    if (ominz < tminz) {\n      tminz = ominz;\n    }\n\n    if (omaxz > tmaxz) {\n      tmaxz = omaxz;\n    }\n\n    tc[0] = (tminx + tmaxx) * 0.5;\n    tc[1] = (tminy + tmaxy) * 0.5;\n    tc[2] = (tminz + tmaxz) * 0.5;\n    th[0] = (tmaxx - tminx) * 0.5;\n    th[1] = (tmaxy - tminy) * 0.5;\n    th[2] = (tmaxz - tminz) * 0.5;\n    this.min[0] = tminx;\n    this.min[1] = tminy;\n    this.min[2] = tminz;\n    this.max[0] = tmaxx;\n    this.max[1] = tmaxy;\n    this.max[2] = tmaxz;\n  };\n\n  AABB.prototype.setFromTransformedAABB = function (aabb, m) {\n    var bc = this.center;\n    var br = this.halfExtents;\n    var ac = aabb.center;\n    var ar = aabb.halfExtents;\n    var mx0 = m[0];\n    var mx1 = m[4];\n    var mx2 = m[8];\n    var my0 = m[1];\n    var my1 = m[5];\n    var my2 = m[9];\n    var mz0 = m[2];\n    var mz1 = m[6];\n    var mz2 = m[10];\n    var mx0a = Math.abs(mx0);\n    var mx1a = Math.abs(mx1);\n    var mx2a = Math.abs(mx2);\n    var my0a = Math.abs(my0);\n    var my1a = Math.abs(my1);\n    var my2a = Math.abs(my2);\n    var mz0a = Math.abs(mz0);\n    var mz1a = Math.abs(mz1);\n    var mz2a = Math.abs(mz2);\n    vec3.set(bc, m[12] + mx0 * ac[0] + mx1 * ac[1] + mx2 * ac[2], m[13] + my0 * ac[0] + my1 * ac[1] + my2 * ac[2], m[14] + mz0 * ac[0] + mz1 * ac[1] + mz2 * ac[2]);\n    vec3.set(br, mx0a * ar[0] + mx1a * ar[1] + mx2a * ar[2], my0a * ar[0] + my1a * ar[1] + my2a * ar[2], mz0a * ar[0] + mz1a * ar[1] + mz2a * ar[2]);\n    this.min = vec3.sub(this.min, bc, br);\n    this.max = vec3.add(this.max, bc, br);\n  };\n\n  AABB.prototype.intersects = function (aabb) {\n    var aMax = this.getMax();\n    var aMin = this.getMin();\n    var bMax = aabb.getMax();\n    var bMin = aabb.getMin();\n    return aMin[0] <= bMax[0] && aMax[0] >= bMin[0] && aMin[1] <= bMax[1] && aMax[1] >= bMin[1] && aMin[2] <= bMax[2] && aMax[2] >= bMin[2];\n  };\n\n  AABB.prototype.intersection = function (aabb) {\n    if (!this.intersects(aabb)) {\n      return null;\n    }\n\n    var intersection = new AABB();\n    var min = vec3.max(vec3.create(), this.getMin(), aabb.getMin());\n    var max = vec3.min(vec3.create(), this.getMax(), aabb.getMax());\n    intersection.setMinMax(min, max);\n    return intersection;\n  };\n\n  AABB.prototype.containsPoint = function (point) {\n    var min = this.getMin();\n    var max = this.getMax();\n    return !(point[0] < min[0] || point[0] > max[0] || point[1] < min[1] || point[1] > max[1] || point[2] < min[2] || point[2] > max[2]);\n  };\n  /**\n   * get n-vertex\n   * @param plane plane of CullingVolume\n   */\n\n\n  AABB.prototype.getNegativeFarPoint = function (plane) {\n    if (plane.pnVertexFlag === 0x111) {\n      return vec3.copy(vec3.create(), this.min);\n    } else if (plane.pnVertexFlag === 0x110) {\n      return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x101) {\n      return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x100) {\n      return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x011) {\n      return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x010) {\n      return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x001) {\n      return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    } else {\n      return vec3.fromValues(this.max[0], this.max[1], this.max[2]);\n    }\n  };\n  /**\n   * get p-vertex\n   * @param plane plane of CullingVolume\n   */\n\n\n  AABB.prototype.getPositiveFarPoint = function (plane) {\n    if (plane.pnVertexFlag === 0x111) {\n      return vec3.copy(vec3.create(), this.max);\n    } else if (plane.pnVertexFlag === 0x110) {\n      return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x101) {\n      return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x100) {\n      return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x011) {\n      return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x010) {\n      return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x001) {\n      return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    } else {\n      return vec3.fromValues(this.min[0], this.min[1], this.min[2]);\n    }\n  };\n\n  return AABB;\n}();\n\nexport { AABB };","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/@antv/g/es/shapes/AABB.js"],"names":["vec3","AABB","center","halfExtents","min","create","max","update","isEmpty","aabb","prototype","copy","fromValues","sub","add","setMinMax","scale","getMin","getMax","tc","tcx","tcy","tcz","th","thx","thy","thz","tminx","tmaxx","tminy","tmaxy","tminz","tmaxz","oc","ocx","ocy","ocz","oh","ohx","ohy","ohz","ominx","omaxx","ominy","omaxy","ominz","omaxz","setFromTransformedAABB","m","bc","br","ac","ar","mx0","mx1","mx2","my0","my1","my2","mz0","mz1","mz2","mx0a","Math","abs","mx1a","mx2a","my0a","my1a","my2a","mz0a","mz1a","mz2a","set","intersects","aMax","aMin","bMax","bMin","intersection","containsPoint","point","getNegativeFarPoint","plane","pnVertexFlag","getPositiveFarPoint"],"mappings":"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","sourcesContent":["import { vec3 } from 'gl-matrix';\n/**\n * Axis-Aligned Bounding Box\n * 为了便于后续 Frustum Culling，通过查找表定义 p-vertex 和 n-vertex\n * @see https://github.com/antvis/GWebGPUEngine/issues/3\n */\n\nvar AABB =\n/** @class */\nfunction () {\n  function AABB(center, halfExtents) {\n    this.min = vec3.create();\n    this.max = vec3.create();\n    this.update(center, halfExtents);\n  }\n\n  AABB.isEmpty = function (aabb) {\n    return !aabb || aabb.halfExtents[0] === 0 && aabb.halfExtents[1] === 0 && aabb.halfExtents[2] === 0;\n  };\n\n  AABB.prototype.update = function (center, halfExtents) {\n    this.center = vec3.copy(vec3.create(), center || vec3.create());\n    this.halfExtents = vec3.copy(vec3.create(), halfExtents || vec3.fromValues(0, 0, 0));\n    this.min = vec3.sub(this.min, this.center, this.halfExtents);\n    this.max = vec3.add(this.max, this.center, this.halfExtents);\n  };\n\n  AABB.prototype.setMinMax = function (min, max) {\n    vec3.add(this.center, max, min);\n    vec3.scale(this.center, this.center, 0.5);\n    vec3.sub(this.halfExtents, max, min);\n    vec3.scale(this.halfExtents, this.halfExtents, 0.5);\n    vec3.copy(this.min, min);\n    vec3.copy(this.max, max);\n  };\n\n  AABB.prototype.getMin = function () {\n    return this.min;\n  };\n\n  AABB.prototype.getMax = function () {\n    return this.max;\n  };\n\n  AABB.prototype.add = function (aabb) {\n    if (AABB.isEmpty(aabb)) {\n      return;\n    }\n\n    if (AABB.isEmpty(this)) {\n      this.setMinMax(aabb.getMin(), aabb.getMax());\n      return;\n    }\n\n    var tc = this.center;\n    var tcx = tc[0];\n    var tcy = tc[1];\n    var tcz = tc[2];\n    var th = this.halfExtents;\n    var thx = th[0];\n    var thy = th[1];\n    var thz = th[2];\n    var tminx = tcx - thx;\n    var tmaxx = tcx + thx;\n    var tminy = tcy - thy;\n    var tmaxy = tcy + thy;\n    var tminz = tcz - thz;\n    var tmaxz = tcz + thz;\n    var oc = aabb.center;\n    var ocx = oc[0];\n    var ocy = oc[1];\n    var ocz = oc[2];\n    var oh = aabb.halfExtents;\n    var ohx = oh[0];\n    var ohy = oh[1];\n    var ohz = oh[2];\n    var ominx = ocx - ohx;\n    var omaxx = ocx + ohx;\n    var ominy = ocy - ohy;\n    var omaxy = ocy + ohy;\n    var ominz = ocz - ohz;\n    var omaxz = ocz + ohz;\n\n    if (ominx < tminx) {\n      tminx = ominx;\n    }\n\n    if (omaxx > tmaxx) {\n      tmaxx = omaxx;\n    }\n\n    if (ominy < tminy) {\n      tminy = ominy;\n    }\n\n    if (omaxy > tmaxy) {\n      tmaxy = omaxy;\n    }\n\n    if (ominz < tminz) {\n      tminz = ominz;\n    }\n\n    if (omaxz > tmaxz) {\n      tmaxz = omaxz;\n    }\n\n    tc[0] = (tminx + tmaxx) * 0.5;\n    tc[1] = (tminy + tmaxy) * 0.5;\n    tc[2] = (tminz + tmaxz) * 0.5;\n    th[0] = (tmaxx - tminx) * 0.5;\n    th[1] = (tmaxy - tminy) * 0.5;\n    th[2] = (tmaxz - tminz) * 0.5;\n    this.min[0] = tminx;\n    this.min[1] = tminy;\n    this.min[2] = tminz;\n    this.max[0] = tmaxx;\n    this.max[1] = tmaxy;\n    this.max[2] = tmaxz;\n  };\n\n  AABB.prototype.setFromTransformedAABB = function (aabb, m) {\n    var bc = this.center;\n    var br = this.halfExtents;\n    var ac = aabb.center;\n    var ar = aabb.halfExtents;\n    var mx0 = m[0];\n    var mx1 = m[4];\n    var mx2 = m[8];\n    var my0 = m[1];\n    var my1 = m[5];\n    var my2 = m[9];\n    var mz0 = m[2];\n    var mz1 = m[6];\n    var mz2 = m[10];\n    var mx0a = Math.abs(mx0);\n    var mx1a = Math.abs(mx1);\n    var mx2a = Math.abs(mx2);\n    var my0a = Math.abs(my0);\n    var my1a = Math.abs(my1);\n    var my2a = Math.abs(my2);\n    var mz0a = Math.abs(mz0);\n    var mz1a = Math.abs(mz1);\n    var mz2a = Math.abs(mz2);\n    vec3.set(bc, m[12] + mx0 * ac[0] + mx1 * ac[1] + mx2 * ac[2], m[13] + my0 * ac[0] + my1 * ac[1] + my2 * ac[2], m[14] + mz0 * ac[0] + mz1 * ac[1] + mz2 * ac[2]);\n    vec3.set(br, mx0a * ar[0] + mx1a * ar[1] + mx2a * ar[2], my0a * ar[0] + my1a * ar[1] + my2a * ar[2], mz0a * ar[0] + mz1a * ar[1] + mz2a * ar[2]);\n    this.min = vec3.sub(this.min, bc, br);\n    this.max = vec3.add(this.max, bc, br);\n  };\n\n  AABB.prototype.intersects = function (aabb) {\n    var aMax = this.getMax();\n    var aMin = this.getMin();\n    var bMax = aabb.getMax();\n    var bMin = aabb.getMin();\n    return aMin[0] <= bMax[0] && aMax[0] >= bMin[0] && aMin[1] <= bMax[1] && aMax[1] >= bMin[1] && aMin[2] <= bMax[2] && aMax[2] >= bMin[2];\n  };\n\n  AABB.prototype.intersection = function (aabb) {\n    if (!this.intersects(aabb)) {\n      return null;\n    }\n\n    var intersection = new AABB();\n    var min = vec3.max(vec3.create(), this.getMin(), aabb.getMin());\n    var max = vec3.min(vec3.create(), this.getMax(), aabb.getMax());\n    intersection.setMinMax(min, max);\n    return intersection;\n  };\n\n  AABB.prototype.containsPoint = function (point) {\n    var min = this.getMin();\n    var max = this.getMax();\n    return !(point[0] < min[0] || point[0] > max[0] || point[1] < min[1] || point[1] > max[1] || point[2] < min[2] || point[2] > max[2]);\n  };\n  /**\n   * get n-vertex\n   * @param plane plane of CullingVolume\n   */\n\n\n  AABB.prototype.getNegativeFarPoint = function (plane) {\n    if (plane.pnVertexFlag === 0x111) {\n      return vec3.copy(vec3.create(), this.min);\n    } else if (plane.pnVertexFlag === 0x110) {\n      return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x101) {\n      return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x100) {\n      return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x011) {\n      return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x010) {\n      return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x001) {\n      return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    } else {\n      return vec3.fromValues(this.max[0], this.max[1], this.max[2]);\n    }\n  };\n  /**\n   * get p-vertex\n   * @param plane plane of CullingVolume\n   */\n\n\n  AABB.prototype.getPositiveFarPoint = function (plane) {\n    if (plane.pnVertexFlag === 0x111) {\n      return vec3.copy(vec3.create(), this.max);\n    } else if (plane.pnVertexFlag === 0x110) {\n      return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x101) {\n      return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x100) {\n      return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x011) {\n      return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    } else if (plane.pnVertexFlag === 0x010) {\n      return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    } else if (plane.pnVertexFlag === 0x001) {\n      return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    } else {\n      return vec3.fromValues(this.min[0], this.min[1], this.min[2]);\n    }\n  };\n\n  return AABB;\n}();\n\nexport { AABB };"]},"metadata":{},"sourceType":"module"}