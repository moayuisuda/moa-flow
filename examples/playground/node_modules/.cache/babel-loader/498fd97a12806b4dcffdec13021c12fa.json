{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nvar _excluded = [\"name\", \"errors\"];\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport { HOOK_MARK } from './FieldContext';\nimport { allPromiseFinish } from './utils/asyncUtil';\nimport NameMap from './utils/NameMap';\nimport { defaultValidateMessages } from './utils/messages';\nimport { cloneByNamePathList, containsNamePath, getNamePath, getValue, matchNamePath, setValue, setValues } from './utils/valueUtil';\nimport cloneDeep from './utils/cloneDeep';\nexport var FormStore = /*#__PURE__*/_createClass(function FormStore(forceRootUpdate) {\n  var _this = this;\n\n  _classCallCheck(this, FormStore);\n\n  this.formHooked = false;\n  this.forceRootUpdate = void 0;\n  this.subscribable = true;\n  this.store = {};\n  this.fieldEntities = [];\n  this.initialValues = {};\n  this.callbacks = {};\n  this.validateMessages = null;\n  this.preserve = null;\n  this.lastValidatePromise = null;\n\n  this.getForm = function () {\n    return {\n      getFieldValue: _this.getFieldValue,\n      getFieldsValue: _this.getFieldsValue,\n      getFieldError: _this.getFieldError,\n      getFieldWarning: _this.getFieldWarning,\n      getFieldsError: _this.getFieldsError,\n      isFieldsTouched: _this.isFieldsTouched,\n      isFieldTouched: _this.isFieldTouched,\n      isFieldValidating: _this.isFieldValidating,\n      isFieldsValidating: _this.isFieldsValidating,\n      resetFields: _this.resetFields,\n      setFields: _this.setFields,\n      setFieldsValue: _this.setFieldsValue,\n      validateFields: _this.validateFields,\n      submit: _this.submit,\n      getInternalHooks: _this.getInternalHooks\n    };\n  };\n\n  this.getInternalHooks = function (key) {\n    if (key === HOOK_MARK) {\n      _this.formHooked = true;\n      return {\n        dispatch: _this.dispatch,\n        initEntityValue: _this.initEntityValue,\n        registerField: _this.registerField,\n        useSubscribe: _this.useSubscribe,\n        setInitialValues: _this.setInitialValues,\n        destroyForm: _this.destroyForm,\n        setCallbacks: _this.setCallbacks,\n        setValidateMessages: _this.setValidateMessages,\n        getFields: _this.getFields,\n        setPreserve: _this.setPreserve,\n        getInitialValue: _this.getInitialValue\n      };\n    }\n\n    warning(false, '`getInternalHooks` is internal usage. Should not call directly.');\n    return null;\n  };\n\n  this.useSubscribe = function (subscribable) {\n    _this.subscribable = subscribable;\n  };\n\n  this.prevWithoutPreserves = null;\n\n  this.setInitialValues = function (initialValues, init) {\n    _this.initialValues = initialValues || {};\n\n    if (init) {\n      var _this$prevWithoutPres;\n\n      var nextStore = setValues({}, initialValues, _this.store); // We will take consider prev form unmount fields.\n      // When the field is not `preserve`, we need fill this with initialValues instead of store.\n\n      (_this$prevWithoutPres = _this.prevWithoutPreserves) === null || _this$prevWithoutPres === void 0 ? void 0 : _this$prevWithoutPres.map(function (_ref) {\n        var namePath = _ref.key;\n        nextStore = setValue(nextStore, namePath, getValue(initialValues, namePath));\n      });\n      _this.prevWithoutPreserves = null;\n\n      _this.updateStore(nextStore);\n    }\n  };\n\n  this.destroyForm = function () {\n    var prevWithoutPreserves = new NameMap();\n\n    _this.getFieldEntities(true).forEach(function (entity) {\n      if (!entity.isPreserve()) {\n        prevWithoutPreserves.set(entity.getNamePath(), true);\n      }\n    });\n\n    _this.prevWithoutPreserves = prevWithoutPreserves;\n  };\n\n  this.getInitialValue = function (namePath) {\n    var initValue = getValue(_this.initialValues, namePath); // Not cloneDeep when without `namePath`\n\n    return namePath.length ? cloneDeep(initValue) : initValue;\n  };\n\n  this.setCallbacks = function (callbacks) {\n    _this.callbacks = callbacks;\n  };\n\n  this.setValidateMessages = function (validateMessages) {\n    _this.validateMessages = validateMessages;\n  };\n\n  this.setPreserve = function (preserve) {\n    _this.preserve = preserve;\n  };\n\n  this.timeoutId = null;\n\n  this.warningUnhooked = function () {\n    if (process.env.NODE_ENV !== 'production' && !_this.timeoutId && typeof window !== 'undefined') {\n      _this.timeoutId = setTimeout(function () {\n        _this.timeoutId = null;\n\n        if (!_this.formHooked) {\n          warning(false, 'Instance created by `useForm` is not connected to any Form element. Forget to pass `form` prop?');\n        }\n      });\n    }\n  };\n\n  this.updateStore = function (nextStore) {\n    _this.store = nextStore;\n  };\n\n  this.getFieldEntities = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (!pure) {\n      return _this.fieldEntities;\n    }\n\n    return _this.fieldEntities.filter(function (field) {\n      return field.getNamePath().length;\n    });\n  };\n\n  this.getFieldsMap = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var cache = new NameMap();\n\n    _this.getFieldEntities(pure).forEach(function (field) {\n      var namePath = field.getNamePath();\n      cache.set(namePath, field);\n    });\n\n    return cache;\n  };\n\n  this.getFieldEntitiesForNamePathList = function (nameList) {\n    if (!nameList) {\n      return _this.getFieldEntities(true);\n    }\n\n    var cache = _this.getFieldsMap(true);\n\n    return nameList.map(function (name) {\n      var namePath = getNamePath(name);\n      return cache.get(namePath) || {\n        INVALIDATE_NAME_PATH: getNamePath(name)\n      };\n    });\n  };\n\n  this.getFieldsValue = function (nameList, filterFunc) {\n    _this.warningUnhooked();\n\n    if (nameList === true && !filterFunc) {\n      return _this.store;\n    }\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(Array.isArray(nameList) ? nameList : null);\n\n    var filteredNameList = [];\n    fieldEntities.forEach(function (entity) {\n      var _entity$isListField;\n\n      var namePath = 'INVALIDATE_NAME_PATH' in entity ? entity.INVALIDATE_NAME_PATH : entity.getNamePath(); // Ignore when it's a list item and not specific the namePath,\n      // since parent field is already take in count\n\n      if (!nameList && ((_entity$isListField = entity.isListField) === null || _entity$isListField === void 0 ? void 0 : _entity$isListField.call(entity))) {\n        return;\n      }\n\n      if (!filterFunc) {\n        filteredNameList.push(namePath);\n      } else {\n        var meta = 'getMeta' in entity ? entity.getMeta() : null;\n\n        if (filterFunc(meta)) {\n          filteredNameList.push(namePath);\n        }\n      }\n    });\n    return cloneByNamePathList(_this.store, filteredNameList.map(getNamePath));\n  };\n\n  this.getFieldValue = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n    return getValue(_this.store, namePath);\n  };\n\n  this.getFieldsError = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(nameList);\n\n    return fieldEntities.map(function (entity, index) {\n      if (entity && !('INVALIDATE_NAME_PATH' in entity)) {\n        return {\n          name: entity.getNamePath(),\n          errors: entity.getErrors(),\n          warnings: entity.getWarnings()\n        };\n      }\n\n      return {\n        name: getNamePath(nameList[index]),\n        errors: [],\n        warnings: []\n      };\n    });\n  };\n\n  this.getFieldError = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n\n    var fieldError = _this.getFieldsError([namePath])[0];\n\n    return fieldError.errors;\n  };\n\n  this.getFieldWarning = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n\n    var fieldError = _this.getFieldsError([namePath])[0];\n\n    return fieldError.warnings;\n  };\n\n  this.isFieldsTouched = function () {\n    _this.warningUnhooked();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var arg0 = args[0],\n        arg1 = args[1];\n    var namePathList;\n    var isAllFieldsTouched = false;\n\n    if (args.length === 0) {\n      namePathList = null;\n    } else if (args.length === 1) {\n      if (Array.isArray(arg0)) {\n        namePathList = arg0.map(getNamePath);\n        isAllFieldsTouched = false;\n      } else {\n        namePathList = null;\n        isAllFieldsTouched = arg0;\n      }\n    } else {\n      namePathList = arg0.map(getNamePath);\n      isAllFieldsTouched = arg1;\n    }\n\n    var fieldEntities = _this.getFieldEntities(true);\n\n    var isFieldTouched = function isFieldTouched(field) {\n      return field.isFieldTouched();\n    }; // ===== Will get fully compare when not config namePathList =====\n\n\n    if (!namePathList) {\n      return isAllFieldsTouched ? fieldEntities.every(isFieldTouched) : fieldEntities.some(isFieldTouched);\n    } // Generate a nest tree for validate\n\n\n    var map = new NameMap();\n    namePathList.forEach(function (shortNamePath) {\n      map.set(shortNamePath, []);\n    });\n    fieldEntities.forEach(function (field) {\n      var fieldNamePath = field.getNamePath(); // Find matched entity and put into list\n\n      namePathList.forEach(function (shortNamePath) {\n        if (shortNamePath.every(function (nameUnit, i) {\n          return fieldNamePath[i] === nameUnit;\n        })) {\n          map.update(shortNamePath, function (list) {\n            return [].concat(_toConsumableArray(list), [field]);\n          });\n        }\n      });\n    }); // Check if NameMap value is touched\n\n    var isNamePathListTouched = function isNamePathListTouched(entities) {\n      return entities.some(isFieldTouched);\n    };\n\n    var namePathListEntities = map.map(function (_ref2) {\n      var value = _ref2.value;\n      return value;\n    });\n    return isAllFieldsTouched ? namePathListEntities.every(isNamePathListTouched) : namePathListEntities.some(isNamePathListTouched);\n  };\n\n  this.isFieldTouched = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsTouched([name]);\n  };\n\n  this.isFieldsValidating = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntities();\n\n    if (!nameList) {\n      return fieldEntities.some(function (testField) {\n        return testField.isFieldValidating();\n      });\n    }\n\n    var namePathList = nameList.map(getNamePath);\n    return fieldEntities.some(function (testField) {\n      var fieldNamePath = testField.getNamePath();\n      return containsNamePath(namePathList, fieldNamePath) && testField.isFieldValidating();\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsValidating([name]);\n  };\n\n  this.resetWithFieldInitialValue = function () {\n    var info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; // Create cache\n\n    var cache = new NameMap();\n\n    var fieldEntities = _this.getFieldEntities(true);\n\n    fieldEntities.forEach(function (field) {\n      var initialValue = field.props.initialValue;\n      var namePath = field.getNamePath(); // Record only if has `initialValue`\n\n      if (initialValue !== undefined) {\n        var records = cache.get(namePath) || new Set();\n        records.add({\n          entity: field,\n          value: initialValue\n        });\n        cache.set(namePath, records);\n      }\n    }); // Reset\n\n    var resetWithFields = function resetWithFields(entities) {\n      entities.forEach(function (field) {\n        var initialValue = field.props.initialValue;\n\n        if (initialValue !== undefined) {\n          var namePath = field.getNamePath();\n\n          var formInitialValue = _this.getInitialValue(namePath);\n\n          if (formInitialValue !== undefined) {\n            // Warning if conflict with form initialValues and do not modify value\n            warning(false, \"Form already set 'initialValues' with path '\".concat(namePath.join('.'), \"'. Field can not overwrite it.\"));\n          } else {\n            var records = cache.get(namePath);\n\n            if (records && records.size > 1) {\n              // Warning if multiple field set `initialValue`and do not modify value\n              warning(false, \"Multiple Field with path '\".concat(namePath.join('.'), \"' set 'initialValue'. Can not decide which one to pick.\"));\n            } else if (records) {\n              var originValue = _this.getFieldValue(namePath); // Set `initialValue`\n\n\n              if (!info.skipExist || originValue === undefined) {\n                _this.updateStore(setValue(_this.store, namePath, _toConsumableArray(records)[0].value));\n              }\n            }\n          }\n        }\n      });\n    };\n\n    var requiredFieldEntities;\n\n    if (info.entities) {\n      requiredFieldEntities = info.entities;\n    } else if (info.namePathList) {\n      requiredFieldEntities = [];\n      info.namePathList.forEach(function (namePath) {\n        var records = cache.get(namePath);\n\n        if (records) {\n          var _requiredFieldEntitie;\n\n          (_requiredFieldEntitie = requiredFieldEntities).push.apply(_requiredFieldEntitie, _toConsumableArray(_toConsumableArray(records).map(function (r) {\n            return r.entity;\n          })));\n        }\n      });\n    } else {\n      requiredFieldEntities = fieldEntities;\n    }\n\n    resetWithFields(requiredFieldEntities);\n  };\n\n  this.resetFields = function (nameList) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (!nameList) {\n      _this.updateStore(setValues({}, _this.initialValues));\n\n      _this.resetWithFieldInitialValue();\n\n      _this.notifyObservers(prevStore, null, {\n        type: 'reset'\n      });\n\n      return;\n    } // Reset by `nameList`\n\n\n    var namePathList = nameList.map(getNamePath);\n    namePathList.forEach(function (namePath) {\n      var initialValue = _this.getInitialValue(namePath);\n\n      _this.updateStore(setValue(_this.store, namePath, initialValue));\n    });\n\n    _this.resetWithFieldInitialValue({\n      namePathList: namePathList\n    });\n\n    _this.notifyObservers(prevStore, namePathList, {\n      type: 'reset'\n    });\n  };\n\n  this.setFields = function (fields) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n    fields.forEach(function (fieldData) {\n      var name = fieldData.name,\n          errors = fieldData.errors,\n          data = _objectWithoutProperties(fieldData, _excluded);\n\n      var namePath = getNamePath(name); // Value\n\n      if ('value' in data) {\n        _this.updateStore(setValue(_this.store, namePath, data.value));\n      }\n\n      _this.notifyObservers(prevStore, [namePath], {\n        type: 'setField',\n        data: fieldData\n      });\n    });\n  };\n\n  this.getFields = function () {\n    var entities = _this.getFieldEntities(true);\n\n    var fields = entities.map(function (field) {\n      var namePath = field.getNamePath();\n      var meta = field.getMeta();\n\n      var fieldData = _objectSpread(_objectSpread({}, meta), {}, {\n        name: namePath,\n        value: _this.getFieldValue(namePath)\n      });\n\n      Object.defineProperty(fieldData, 'originRCField', {\n        value: true\n      });\n      return fieldData;\n    });\n    return fields;\n  };\n\n  this.initEntityValue = function (entity) {\n    var initialValue = entity.props.initialValue;\n\n    if (initialValue !== undefined) {\n      var namePath = entity.getNamePath();\n      var prevValue = getValue(_this.store, namePath);\n\n      if (prevValue === undefined) {\n        _this.updateStore(setValue(_this.store, namePath, initialValue));\n      }\n    }\n  };\n\n  this.registerField = function (entity) {\n    _this.fieldEntities.push(entity); // Set initial values\n\n\n    if (entity.props.initialValue !== undefined) {\n      var prevStore = _this.store;\n\n      _this.resetWithFieldInitialValue({\n        entities: [entity],\n        skipExist: true\n      });\n\n      _this.notifyObservers(prevStore, [entity.getNamePath()], {\n        type: 'valueUpdate',\n        source: 'internal'\n      });\n    } // un-register field callback\n\n\n    return function (isListField, preserve) {\n      var subNamePath = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      _this.fieldEntities = _this.fieldEntities.filter(function (item) {\n        return item !== entity;\n      }); // Clean up store value if not preserve\n\n      var mergedPreserve = preserve !== undefined ? preserve : _this.preserve;\n\n      if (mergedPreserve === false && (!isListField || subNamePath.length > 1)) {\n        var namePath = entity.getNamePath();\n        var defaultValue = isListField ? undefined : _this.getInitialValue(namePath);\n\n        if (namePath.length && _this.getFieldValue(namePath) !== defaultValue && _this.fieldEntities.every(function (field) {\n          return (// Only reset when no namePath exist\n            !matchNamePath(field.getNamePath(), namePath)\n          );\n        })) {\n          var _prevStore = _this.store;\n\n          _this.updateStore(setValue(_prevStore, namePath, defaultValue, true)); // Notify that field is unmount\n\n\n          _this.notifyObservers(_prevStore, [namePath], {\n            type: 'remove'\n          }); // Dependencies update\n\n\n          _this.triggerDependenciesUpdate(_prevStore, namePath);\n        }\n      }\n    };\n  };\n\n  this.dispatch = function (action) {\n    switch (action.type) {\n      case 'updateValue':\n        {\n          var namePath = action.namePath,\n              value = action.value;\n\n          _this.updateValue(namePath, value);\n\n          break;\n        }\n\n      case 'validateField':\n        {\n          var _namePath = action.namePath,\n              triggerName = action.triggerName;\n\n          _this.validateFields([_namePath], {\n            triggerName: triggerName\n          });\n\n          break;\n        }\n\n      default: // Currently we don't have other action. Do nothing.\n\n    }\n  };\n\n  this.notifyObservers = function (prevStore, namePathList, info) {\n    if (_this.subscribable) {\n      var mergedInfo = _objectSpread(_objectSpread({}, info), {}, {\n        store: _this.getFieldsValue(true)\n      });\n\n      _this.getFieldEntities().forEach(function (_ref3) {\n        var onStoreChange = _ref3.onStoreChange;\n        onStoreChange(prevStore, namePathList, mergedInfo);\n      });\n    } else {\n      _this.forceRootUpdate();\n    }\n  };\n\n  this.triggerDependenciesUpdate = function (prevStore, namePath) {\n    var childrenFields = _this.getDependencyChildrenFields(namePath);\n\n    if (childrenFields.length) {\n      _this.validateFields(childrenFields);\n    }\n\n    _this.notifyObservers(prevStore, childrenFields, {\n      type: 'dependenciesUpdate',\n      relatedFields: [namePath].concat(_toConsumableArray(childrenFields))\n    });\n\n    return childrenFields;\n  };\n\n  this.updateValue = function (name, value) {\n    var namePath = getNamePath(name);\n    var prevStore = _this.store;\n\n    _this.updateStore(setValue(_this.store, namePath, value));\n\n    _this.notifyObservers(prevStore, [namePath], {\n      type: 'valueUpdate',\n      source: 'internal'\n    }); // Dependencies update\n\n\n    var childrenFields = _this.triggerDependenciesUpdate(prevStore, namePath); // trigger callback function\n\n\n    var onValuesChange = _this.callbacks.onValuesChange;\n\n    if (onValuesChange) {\n      var changedValues = cloneByNamePathList(_this.store, [namePath]);\n      onValuesChange(changedValues, _this.getFieldsValue());\n    }\n\n    _this.triggerOnFieldsChange([namePath].concat(_toConsumableArray(childrenFields)));\n  };\n\n  this.setFieldsValue = function (store) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (store) {\n      _this.updateStore(setValues(_this.store, store));\n    }\n\n    _this.notifyObservers(prevStore, null, {\n      type: 'valueUpdate',\n      source: 'external'\n    });\n  };\n\n  this.getDependencyChildrenFields = function (rootNamePath) {\n    var children = new Set();\n    var childrenFields = [];\n    var dependencies2fields = new NameMap();\n    /**\n     * Generate maps\n     * Can use cache to save perf if user report performance issue with this\n     */\n\n    _this.getFieldEntities().forEach(function (field) {\n      var dependencies = field.props.dependencies;\n      (dependencies || []).forEach(function (dependency) {\n        var dependencyNamePath = getNamePath(dependency);\n        dependencies2fields.update(dependencyNamePath, function () {\n          var fields = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Set();\n          fields.add(field);\n          return fields;\n        });\n      });\n    });\n\n    var fillChildren = function fillChildren(namePath) {\n      var fields = dependencies2fields.get(namePath) || new Set();\n      fields.forEach(function (field) {\n        if (!children.has(field)) {\n          children.add(field);\n          var fieldNamePath = field.getNamePath();\n\n          if (field.isFieldDirty() && fieldNamePath.length) {\n            childrenFields.push(fieldNamePath);\n            fillChildren(fieldNamePath);\n          }\n        }\n      });\n    };\n\n    fillChildren(rootNamePath);\n    return childrenFields;\n  };\n\n  this.triggerOnFieldsChange = function (namePathList, filedErrors) {\n    var onFieldsChange = _this.callbacks.onFieldsChange;\n\n    if (onFieldsChange) {\n      var fields = _this.getFields();\n      /**\n       * Fill errors since `fields` may be replaced by controlled fields\n       */\n\n\n      if (filedErrors) {\n        var cache = new NameMap();\n        filedErrors.forEach(function (_ref4) {\n          var name = _ref4.name,\n              errors = _ref4.errors;\n          cache.set(name, errors);\n        });\n        fields.forEach(function (field) {\n          // eslint-disable-next-line no-param-reassign\n          field.errors = cache.get(field.name) || field.errors;\n        });\n      }\n\n      var changedFields = fields.filter(function (_ref5) {\n        var fieldName = _ref5.name;\n        return containsNamePath(namePathList, fieldName);\n      });\n      onFieldsChange(changedFields, fields);\n    }\n  };\n\n  this.validateFields = function (nameList, options) {\n    _this.warningUnhooked();\n\n    var provideNameList = !!nameList;\n    var namePathList = provideNameList ? nameList.map(getNamePath) : []; // Collect result in promise list\n\n    var promiseList = [];\n\n    _this.getFieldEntities(true).forEach(function (field) {\n      // Add field if not provide `nameList`\n      if (!provideNameList) {\n        namePathList.push(field.getNamePath());\n      }\n      /**\n       * Recursive validate if configured.\n       * TODO: perf improvement @zombieJ\n       */\n\n\n      if ((options === null || options === void 0 ? void 0 : options.recursive) && provideNameList) {\n        var namePath = field.getNamePath();\n\n        if ( // nameList[i] === undefined 说明是以 nameList 开头的\n        // ['name'] -> ['name','list']\n        namePath.every(function (nameUnit, i) {\n          return nameList[i] === nameUnit || nameList[i] === undefined;\n        })) {\n          namePathList.push(namePath);\n        }\n      } // Skip if without rule\n\n\n      if (!field.props.rules || !field.props.rules.length) {\n        return;\n      }\n\n      var fieldNamePath = field.getNamePath(); // Add field validate rule in to promise list\n\n      if (!provideNameList || containsNamePath(namePathList, fieldNamePath)) {\n        var promise = field.validateRules(_objectSpread({\n          validateMessages: _objectSpread(_objectSpread({}, defaultValidateMessages), _this.validateMessages)\n        }, options)); // Wrap promise with field\n\n        promiseList.push(promise.then(function () {\n          return {\n            name: fieldNamePath,\n            errors: [],\n            warnings: []\n          };\n        }).catch(function (ruleErrors) {\n          var mergedErrors = [];\n          var mergedWarnings = [];\n          ruleErrors.forEach(function (_ref6) {\n            var warningOnly = _ref6.rule.warningOnly,\n                errors = _ref6.errors;\n\n            if (warningOnly) {\n              mergedWarnings.push.apply(mergedWarnings, _toConsumableArray(errors));\n            } else {\n              mergedErrors.push.apply(mergedErrors, _toConsumableArray(errors));\n            }\n          });\n\n          if (mergedErrors.length) {\n            return Promise.reject({\n              name: fieldNamePath,\n              errors: mergedErrors,\n              warnings: mergedWarnings\n            });\n          }\n\n          return {\n            name: fieldNamePath,\n            errors: mergedErrors,\n            warnings: mergedWarnings\n          };\n        }));\n      }\n    });\n\n    var summaryPromise = allPromiseFinish(promiseList);\n    _this.lastValidatePromise = summaryPromise; // Notify fields with rule that validate has finished and need update\n\n    summaryPromise.catch(function (results) {\n      return results;\n    }).then(function (results) {\n      var resultNamePathList = results.map(function (_ref7) {\n        var name = _ref7.name;\n        return name;\n      });\n\n      _this.notifyObservers(_this.store, resultNamePathList, {\n        type: 'validateFinish'\n      });\n\n      _this.triggerOnFieldsChange(resultNamePathList, results);\n    });\n    var returnPromise = summaryPromise.then(function () {\n      if (_this.lastValidatePromise === summaryPromise) {\n        return Promise.resolve(_this.getFieldsValue(namePathList));\n      }\n\n      return Promise.reject([]);\n    }).catch(function (results) {\n      var errorList = results.filter(function (result) {\n        return result && result.errors.length;\n      });\n      return Promise.reject({\n        values: _this.getFieldsValue(namePathList),\n        errorFields: errorList,\n        outOfDate: _this.lastValidatePromise !== summaryPromise\n      });\n    }); // Do not throw in console\n\n    returnPromise.catch(function (e) {\n      return e;\n    });\n    return returnPromise;\n  };\n\n  this.submit = function () {\n    _this.warningUnhooked();\n\n    _this.validateFields().then(function (values) {\n      var onFinish = _this.callbacks.onFinish;\n\n      if (onFinish) {\n        try {\n          onFinish(values);\n        } catch (err) {\n          // Should print error if user `onFinish` callback failed\n          console.error(err);\n        }\n      }\n    }).catch(function (e) {\n      var onFinishFailed = _this.callbacks.onFinishFailed;\n\n      if (onFinishFailed) {\n        onFinishFailed(e);\n      }\n    });\n  };\n\n  this.forceRootUpdate = forceRootUpdate;\n});\n\nfunction useForm(form) {\n  var formRef = React.useRef();\n\n  var _React$useState = React.useState({}),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      forceUpdate = _React$useState2[1];\n\n  if (!formRef.current) {\n    if (form) {\n      formRef.current = form;\n    } else {\n      // Create a new FormStore if not provided\n      var forceReRender = function forceReRender() {\n        forceUpdate({});\n      };\n\n      var formStore = new FormStore(forceReRender);\n      formRef.current = formStore.getForm();\n    }\n  }\n\n  return [formRef.current];\n}\n\nexport default useForm;","map":{"version":3,"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/rc-field-form/es/useForm.js"],"names":["_slicedToArray","_objectSpread","_objectWithoutProperties","_toConsumableArray","_createClass","_classCallCheck","_excluded","React","warning","HOOK_MARK","allPromiseFinish","NameMap","defaultValidateMessages","cloneByNamePathList","containsNamePath","getNamePath","getValue","matchNamePath","setValue","setValues","cloneDeep","FormStore","forceRootUpdate","_this","formHooked","subscribable","store","fieldEntities","initialValues","callbacks","validateMessages","preserve","lastValidatePromise","getForm","getFieldValue","getFieldsValue","getFieldError","getFieldWarning","getFieldsError","isFieldsTouched","isFieldTouched","isFieldValidating","isFieldsValidating","resetFields","setFields","setFieldsValue","validateFields","submit","getInternalHooks","key","dispatch","initEntityValue","registerField","useSubscribe","setInitialValues","destroyForm","setCallbacks","setValidateMessages","getFields","setPreserve","getInitialValue","prevWithoutPreserves","init","_this$prevWithoutPres","nextStore","map","_ref","namePath","updateStore","getFieldEntities","forEach","entity","isPreserve","set","initValue","length","timeoutId","warningUnhooked","process","env","NODE_ENV","window","setTimeout","pure","arguments","undefined","filter","field","getFieldsMap","cache","getFieldEntitiesForNamePathList","nameList","name","get","INVALIDATE_NAME_PATH","filterFunc","Array","isArray","filteredNameList","_entity$isListField","isListField","call","push","meta","getMeta","index","errors","getErrors","warnings","getWarnings","fieldError","_len","args","_key","arg0","arg1","namePathList","isAllFieldsTouched","every","some","shortNamePath","fieldNamePath","nameUnit","i","update","list","concat","isNamePathListTouched","entities","namePathListEntities","_ref2","value","testField","resetWithFieldInitialValue","info","initialValue","props","records","Set","add","resetWithFields","formInitialValue","join","size","originValue","skipExist","requiredFieldEntities","_requiredFieldEntitie","apply","r","prevStore","notifyObservers","type","fields","fieldData","data","Object","defineProperty","prevValue","source","subNamePath","item","mergedPreserve","defaultValue","_prevStore","triggerDependenciesUpdate","action","updateValue","_namePath","triggerName","mergedInfo","_ref3","onStoreChange","childrenFields","getDependencyChildrenFields","relatedFields","onValuesChange","changedValues","triggerOnFieldsChange","rootNamePath","children","dependencies2fields","dependencies","dependency","dependencyNamePath","fillChildren","has","isFieldDirty","filedErrors","onFieldsChange","_ref4","changedFields","_ref5","fieldName","options","provideNameList","promiseList","recursive","rules","promise","validateRules","then","catch","ruleErrors","mergedErrors","mergedWarnings","_ref6","warningOnly","rule","Promise","reject","summaryPromise","results","resultNamePathList","_ref7","returnPromise","resolve","errorList","result","values","errorFields","outOfDate","e","onFinish","err","console","error","onFinishFailed","useForm","form","formRef","useRef","_React$useState","useState","_React$useState2","forceUpdate","current","forceReRender","formStore"],"mappings":"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","sourcesContent":["import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nvar _excluded = [\"name\", \"errors\"];\nimport * as React from 'react';\nimport warning from \"rc-util/es/warning\";\nimport { HOOK_MARK } from './FieldContext';\nimport { allPromiseFinish } from './utils/asyncUtil';\nimport NameMap from './utils/NameMap';\nimport { defaultValidateMessages } from './utils/messages';\nimport { cloneByNamePathList, containsNamePath, getNamePath, getValue, matchNamePath, setValue, setValues } from './utils/valueUtil';\nimport cloneDeep from './utils/cloneDeep';\nexport var FormStore = /*#__PURE__*/_createClass(function FormStore(forceRootUpdate) {\n  var _this = this;\n\n  _classCallCheck(this, FormStore);\n\n  this.formHooked = false;\n  this.forceRootUpdate = void 0;\n  this.subscribable = true;\n  this.store = {};\n  this.fieldEntities = [];\n  this.initialValues = {};\n  this.callbacks = {};\n  this.validateMessages = null;\n  this.preserve = null;\n  this.lastValidatePromise = null;\n\n  this.getForm = function () {\n    return {\n      getFieldValue: _this.getFieldValue,\n      getFieldsValue: _this.getFieldsValue,\n      getFieldError: _this.getFieldError,\n      getFieldWarning: _this.getFieldWarning,\n      getFieldsError: _this.getFieldsError,\n      isFieldsTouched: _this.isFieldsTouched,\n      isFieldTouched: _this.isFieldTouched,\n      isFieldValidating: _this.isFieldValidating,\n      isFieldsValidating: _this.isFieldsValidating,\n      resetFields: _this.resetFields,\n      setFields: _this.setFields,\n      setFieldsValue: _this.setFieldsValue,\n      validateFields: _this.validateFields,\n      submit: _this.submit,\n      getInternalHooks: _this.getInternalHooks\n    };\n  };\n\n  this.getInternalHooks = function (key) {\n    if (key === HOOK_MARK) {\n      _this.formHooked = true;\n      return {\n        dispatch: _this.dispatch,\n        initEntityValue: _this.initEntityValue,\n        registerField: _this.registerField,\n        useSubscribe: _this.useSubscribe,\n        setInitialValues: _this.setInitialValues,\n        destroyForm: _this.destroyForm,\n        setCallbacks: _this.setCallbacks,\n        setValidateMessages: _this.setValidateMessages,\n        getFields: _this.getFields,\n        setPreserve: _this.setPreserve,\n        getInitialValue: _this.getInitialValue\n      };\n    }\n\n    warning(false, '`getInternalHooks` is internal usage. Should not call directly.');\n    return null;\n  };\n\n  this.useSubscribe = function (subscribable) {\n    _this.subscribable = subscribable;\n  };\n\n  this.prevWithoutPreserves = null;\n\n  this.setInitialValues = function (initialValues, init) {\n    _this.initialValues = initialValues || {};\n\n    if (init) {\n      var _this$prevWithoutPres;\n\n      var nextStore = setValues({}, initialValues, _this.store); // We will take consider prev form unmount fields.\n      // When the field is not `preserve`, we need fill this with initialValues instead of store.\n\n      (_this$prevWithoutPres = _this.prevWithoutPreserves) === null || _this$prevWithoutPres === void 0 ? void 0 : _this$prevWithoutPres.map(function (_ref) {\n        var namePath = _ref.key;\n        nextStore = setValue(nextStore, namePath, getValue(initialValues, namePath));\n      });\n      _this.prevWithoutPreserves = null;\n\n      _this.updateStore(nextStore);\n    }\n  };\n\n  this.destroyForm = function () {\n    var prevWithoutPreserves = new NameMap();\n\n    _this.getFieldEntities(true).forEach(function (entity) {\n      if (!entity.isPreserve()) {\n        prevWithoutPreserves.set(entity.getNamePath(), true);\n      }\n    });\n\n    _this.prevWithoutPreserves = prevWithoutPreserves;\n  };\n\n  this.getInitialValue = function (namePath) {\n    var initValue = getValue(_this.initialValues, namePath); // Not cloneDeep when without `namePath`\n\n    return namePath.length ? cloneDeep(initValue) : initValue;\n  };\n\n  this.setCallbacks = function (callbacks) {\n    _this.callbacks = callbacks;\n  };\n\n  this.setValidateMessages = function (validateMessages) {\n    _this.validateMessages = validateMessages;\n  };\n\n  this.setPreserve = function (preserve) {\n    _this.preserve = preserve;\n  };\n\n  this.timeoutId = null;\n\n  this.warningUnhooked = function () {\n    if (process.env.NODE_ENV !== 'production' && !_this.timeoutId && typeof window !== 'undefined') {\n      _this.timeoutId = setTimeout(function () {\n        _this.timeoutId = null;\n\n        if (!_this.formHooked) {\n          warning(false, 'Instance created by `useForm` is not connected to any Form element. Forget to pass `form` prop?');\n        }\n      });\n    }\n  };\n\n  this.updateStore = function (nextStore) {\n    _this.store = nextStore;\n  };\n\n  this.getFieldEntities = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    if (!pure) {\n      return _this.fieldEntities;\n    }\n\n    return _this.fieldEntities.filter(function (field) {\n      return field.getNamePath().length;\n    });\n  };\n\n  this.getFieldsMap = function () {\n    var pure = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var cache = new NameMap();\n\n    _this.getFieldEntities(pure).forEach(function (field) {\n      var namePath = field.getNamePath();\n      cache.set(namePath, field);\n    });\n\n    return cache;\n  };\n\n  this.getFieldEntitiesForNamePathList = function (nameList) {\n    if (!nameList) {\n      return _this.getFieldEntities(true);\n    }\n\n    var cache = _this.getFieldsMap(true);\n\n    return nameList.map(function (name) {\n      var namePath = getNamePath(name);\n      return cache.get(namePath) || {\n        INVALIDATE_NAME_PATH: getNamePath(name)\n      };\n    });\n  };\n\n  this.getFieldsValue = function (nameList, filterFunc) {\n    _this.warningUnhooked();\n\n    if (nameList === true && !filterFunc) {\n      return _this.store;\n    }\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(Array.isArray(nameList) ? nameList : null);\n\n    var filteredNameList = [];\n    fieldEntities.forEach(function (entity) {\n      var _entity$isListField;\n\n      var namePath = 'INVALIDATE_NAME_PATH' in entity ? entity.INVALIDATE_NAME_PATH : entity.getNamePath(); // Ignore when it's a list item and not specific the namePath,\n      // since parent field is already take in count\n\n      if (!nameList && ((_entity$isListField = entity.isListField) === null || _entity$isListField === void 0 ? void 0 : _entity$isListField.call(entity))) {\n        return;\n      }\n\n      if (!filterFunc) {\n        filteredNameList.push(namePath);\n      } else {\n        var meta = 'getMeta' in entity ? entity.getMeta() : null;\n\n        if (filterFunc(meta)) {\n          filteredNameList.push(namePath);\n        }\n      }\n    });\n    return cloneByNamePathList(_this.store, filteredNameList.map(getNamePath));\n  };\n\n  this.getFieldValue = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n    return getValue(_this.store, namePath);\n  };\n\n  this.getFieldsError = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntitiesForNamePathList(nameList);\n\n    return fieldEntities.map(function (entity, index) {\n      if (entity && !('INVALIDATE_NAME_PATH' in entity)) {\n        return {\n          name: entity.getNamePath(),\n          errors: entity.getErrors(),\n          warnings: entity.getWarnings()\n        };\n      }\n\n      return {\n        name: getNamePath(nameList[index]),\n        errors: [],\n        warnings: []\n      };\n    });\n  };\n\n  this.getFieldError = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n\n    var fieldError = _this.getFieldsError([namePath])[0];\n\n    return fieldError.errors;\n  };\n\n  this.getFieldWarning = function (name) {\n    _this.warningUnhooked();\n\n    var namePath = getNamePath(name);\n\n    var fieldError = _this.getFieldsError([namePath])[0];\n\n    return fieldError.warnings;\n  };\n\n  this.isFieldsTouched = function () {\n    _this.warningUnhooked();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var arg0 = args[0],\n        arg1 = args[1];\n    var namePathList;\n    var isAllFieldsTouched = false;\n\n    if (args.length === 0) {\n      namePathList = null;\n    } else if (args.length === 1) {\n      if (Array.isArray(arg0)) {\n        namePathList = arg0.map(getNamePath);\n        isAllFieldsTouched = false;\n      } else {\n        namePathList = null;\n        isAllFieldsTouched = arg0;\n      }\n    } else {\n      namePathList = arg0.map(getNamePath);\n      isAllFieldsTouched = arg1;\n    }\n\n    var fieldEntities = _this.getFieldEntities(true);\n\n    var isFieldTouched = function isFieldTouched(field) {\n      return field.isFieldTouched();\n    }; // ===== Will get fully compare when not config namePathList =====\n\n\n    if (!namePathList) {\n      return isAllFieldsTouched ? fieldEntities.every(isFieldTouched) : fieldEntities.some(isFieldTouched);\n    } // Generate a nest tree for validate\n\n\n    var map = new NameMap();\n    namePathList.forEach(function (shortNamePath) {\n      map.set(shortNamePath, []);\n    });\n    fieldEntities.forEach(function (field) {\n      var fieldNamePath = field.getNamePath(); // Find matched entity and put into list\n\n      namePathList.forEach(function (shortNamePath) {\n        if (shortNamePath.every(function (nameUnit, i) {\n          return fieldNamePath[i] === nameUnit;\n        })) {\n          map.update(shortNamePath, function (list) {\n            return [].concat(_toConsumableArray(list), [field]);\n          });\n        }\n      });\n    }); // Check if NameMap value is touched\n\n    var isNamePathListTouched = function isNamePathListTouched(entities) {\n      return entities.some(isFieldTouched);\n    };\n\n    var namePathListEntities = map.map(function (_ref2) {\n      var value = _ref2.value;\n      return value;\n    });\n    return isAllFieldsTouched ? namePathListEntities.every(isNamePathListTouched) : namePathListEntities.some(isNamePathListTouched);\n  };\n\n  this.isFieldTouched = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsTouched([name]);\n  };\n\n  this.isFieldsValidating = function (nameList) {\n    _this.warningUnhooked();\n\n    var fieldEntities = _this.getFieldEntities();\n\n    if (!nameList) {\n      return fieldEntities.some(function (testField) {\n        return testField.isFieldValidating();\n      });\n    }\n\n    var namePathList = nameList.map(getNamePath);\n    return fieldEntities.some(function (testField) {\n      var fieldNamePath = testField.getNamePath();\n      return containsNamePath(namePathList, fieldNamePath) && testField.isFieldValidating();\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    _this.warningUnhooked();\n\n    return _this.isFieldsValidating([name]);\n  };\n\n  this.resetWithFieldInitialValue = function () {\n    var info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // Create cache\n    var cache = new NameMap();\n\n    var fieldEntities = _this.getFieldEntities(true);\n\n    fieldEntities.forEach(function (field) {\n      var initialValue = field.props.initialValue;\n      var namePath = field.getNamePath(); // Record only if has `initialValue`\n\n      if (initialValue !== undefined) {\n        var records = cache.get(namePath) || new Set();\n        records.add({\n          entity: field,\n          value: initialValue\n        });\n        cache.set(namePath, records);\n      }\n    }); // Reset\n\n    var resetWithFields = function resetWithFields(entities) {\n      entities.forEach(function (field) {\n        var initialValue = field.props.initialValue;\n\n        if (initialValue !== undefined) {\n          var namePath = field.getNamePath();\n\n          var formInitialValue = _this.getInitialValue(namePath);\n\n          if (formInitialValue !== undefined) {\n            // Warning if conflict with form initialValues and do not modify value\n            warning(false, \"Form already set 'initialValues' with path '\".concat(namePath.join('.'), \"'. Field can not overwrite it.\"));\n          } else {\n            var records = cache.get(namePath);\n\n            if (records && records.size > 1) {\n              // Warning if multiple field set `initialValue`and do not modify value\n              warning(false, \"Multiple Field with path '\".concat(namePath.join('.'), \"' set 'initialValue'. Can not decide which one to pick.\"));\n            } else if (records) {\n              var originValue = _this.getFieldValue(namePath); // Set `initialValue`\n\n\n              if (!info.skipExist || originValue === undefined) {\n                _this.updateStore(setValue(_this.store, namePath, _toConsumableArray(records)[0].value));\n              }\n            }\n          }\n        }\n      });\n    };\n\n    var requiredFieldEntities;\n\n    if (info.entities) {\n      requiredFieldEntities = info.entities;\n    } else if (info.namePathList) {\n      requiredFieldEntities = [];\n      info.namePathList.forEach(function (namePath) {\n        var records = cache.get(namePath);\n\n        if (records) {\n          var _requiredFieldEntitie;\n\n          (_requiredFieldEntitie = requiredFieldEntities).push.apply(_requiredFieldEntitie, _toConsumableArray(_toConsumableArray(records).map(function (r) {\n            return r.entity;\n          })));\n        }\n      });\n    } else {\n      requiredFieldEntities = fieldEntities;\n    }\n\n    resetWithFields(requiredFieldEntities);\n  };\n\n  this.resetFields = function (nameList) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (!nameList) {\n      _this.updateStore(setValues({}, _this.initialValues));\n\n      _this.resetWithFieldInitialValue();\n\n      _this.notifyObservers(prevStore, null, {\n        type: 'reset'\n      });\n\n      return;\n    } // Reset by `nameList`\n\n\n    var namePathList = nameList.map(getNamePath);\n    namePathList.forEach(function (namePath) {\n      var initialValue = _this.getInitialValue(namePath);\n\n      _this.updateStore(setValue(_this.store, namePath, initialValue));\n    });\n\n    _this.resetWithFieldInitialValue({\n      namePathList: namePathList\n    });\n\n    _this.notifyObservers(prevStore, namePathList, {\n      type: 'reset'\n    });\n  };\n\n  this.setFields = function (fields) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n    fields.forEach(function (fieldData) {\n      var name = fieldData.name,\n          errors = fieldData.errors,\n          data = _objectWithoutProperties(fieldData, _excluded);\n\n      var namePath = getNamePath(name); // Value\n\n      if ('value' in data) {\n        _this.updateStore(setValue(_this.store, namePath, data.value));\n      }\n\n      _this.notifyObservers(prevStore, [namePath], {\n        type: 'setField',\n        data: fieldData\n      });\n    });\n  };\n\n  this.getFields = function () {\n    var entities = _this.getFieldEntities(true);\n\n    var fields = entities.map(function (field) {\n      var namePath = field.getNamePath();\n      var meta = field.getMeta();\n\n      var fieldData = _objectSpread(_objectSpread({}, meta), {}, {\n        name: namePath,\n        value: _this.getFieldValue(namePath)\n      });\n\n      Object.defineProperty(fieldData, 'originRCField', {\n        value: true\n      });\n      return fieldData;\n    });\n    return fields;\n  };\n\n  this.initEntityValue = function (entity) {\n    var initialValue = entity.props.initialValue;\n\n    if (initialValue !== undefined) {\n      var namePath = entity.getNamePath();\n      var prevValue = getValue(_this.store, namePath);\n\n      if (prevValue === undefined) {\n        _this.updateStore(setValue(_this.store, namePath, initialValue));\n      }\n    }\n  };\n\n  this.registerField = function (entity) {\n    _this.fieldEntities.push(entity); // Set initial values\n\n\n    if (entity.props.initialValue !== undefined) {\n      var prevStore = _this.store;\n\n      _this.resetWithFieldInitialValue({\n        entities: [entity],\n        skipExist: true\n      });\n\n      _this.notifyObservers(prevStore, [entity.getNamePath()], {\n        type: 'valueUpdate',\n        source: 'internal'\n      });\n    } // un-register field callback\n\n\n    return function (isListField, preserve) {\n      var subNamePath = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      _this.fieldEntities = _this.fieldEntities.filter(function (item) {\n        return item !== entity;\n      }); // Clean up store value if not preserve\n\n      var mergedPreserve = preserve !== undefined ? preserve : _this.preserve;\n\n      if (mergedPreserve === false && (!isListField || subNamePath.length > 1)) {\n        var namePath = entity.getNamePath();\n        var defaultValue = isListField ? undefined : _this.getInitialValue(namePath);\n\n        if (namePath.length && _this.getFieldValue(namePath) !== defaultValue && _this.fieldEntities.every(function (field) {\n          return (// Only reset when no namePath exist\n            !matchNamePath(field.getNamePath(), namePath)\n          );\n        })) {\n          var _prevStore = _this.store;\n\n          _this.updateStore(setValue(_prevStore, namePath, defaultValue, true)); // Notify that field is unmount\n\n\n          _this.notifyObservers(_prevStore, [namePath], {\n            type: 'remove'\n          }); // Dependencies update\n\n\n          _this.triggerDependenciesUpdate(_prevStore, namePath);\n        }\n      }\n    };\n  };\n\n  this.dispatch = function (action) {\n    switch (action.type) {\n      case 'updateValue':\n        {\n          var namePath = action.namePath,\n              value = action.value;\n\n          _this.updateValue(namePath, value);\n\n          break;\n        }\n\n      case 'validateField':\n        {\n          var _namePath = action.namePath,\n              triggerName = action.triggerName;\n\n          _this.validateFields([_namePath], {\n            triggerName: triggerName\n          });\n\n          break;\n        }\n\n      default: // Currently we don't have other action. Do nothing.\n\n    }\n  };\n\n  this.notifyObservers = function (prevStore, namePathList, info) {\n    if (_this.subscribable) {\n      var mergedInfo = _objectSpread(_objectSpread({}, info), {}, {\n        store: _this.getFieldsValue(true)\n      });\n\n      _this.getFieldEntities().forEach(function (_ref3) {\n        var onStoreChange = _ref3.onStoreChange;\n        onStoreChange(prevStore, namePathList, mergedInfo);\n      });\n    } else {\n      _this.forceRootUpdate();\n    }\n  };\n\n  this.triggerDependenciesUpdate = function (prevStore, namePath) {\n    var childrenFields = _this.getDependencyChildrenFields(namePath);\n\n    if (childrenFields.length) {\n      _this.validateFields(childrenFields);\n    }\n\n    _this.notifyObservers(prevStore, childrenFields, {\n      type: 'dependenciesUpdate',\n      relatedFields: [namePath].concat(_toConsumableArray(childrenFields))\n    });\n\n    return childrenFields;\n  };\n\n  this.updateValue = function (name, value) {\n    var namePath = getNamePath(name);\n    var prevStore = _this.store;\n\n    _this.updateStore(setValue(_this.store, namePath, value));\n\n    _this.notifyObservers(prevStore, [namePath], {\n      type: 'valueUpdate',\n      source: 'internal'\n    }); // Dependencies update\n\n\n    var childrenFields = _this.triggerDependenciesUpdate(prevStore, namePath); // trigger callback function\n\n\n    var onValuesChange = _this.callbacks.onValuesChange;\n\n    if (onValuesChange) {\n      var changedValues = cloneByNamePathList(_this.store, [namePath]);\n      onValuesChange(changedValues, _this.getFieldsValue());\n    }\n\n    _this.triggerOnFieldsChange([namePath].concat(_toConsumableArray(childrenFields)));\n  };\n\n  this.setFieldsValue = function (store) {\n    _this.warningUnhooked();\n\n    var prevStore = _this.store;\n\n    if (store) {\n      _this.updateStore(setValues(_this.store, store));\n    }\n\n    _this.notifyObservers(prevStore, null, {\n      type: 'valueUpdate',\n      source: 'external'\n    });\n  };\n\n  this.getDependencyChildrenFields = function (rootNamePath) {\n    var children = new Set();\n    var childrenFields = [];\n    var dependencies2fields = new NameMap();\n    /**\n     * Generate maps\n     * Can use cache to save perf if user report performance issue with this\n     */\n\n    _this.getFieldEntities().forEach(function (field) {\n      var dependencies = field.props.dependencies;\n      (dependencies || []).forEach(function (dependency) {\n        var dependencyNamePath = getNamePath(dependency);\n        dependencies2fields.update(dependencyNamePath, function () {\n          var fields = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Set();\n          fields.add(field);\n          return fields;\n        });\n      });\n    });\n\n    var fillChildren = function fillChildren(namePath) {\n      var fields = dependencies2fields.get(namePath) || new Set();\n      fields.forEach(function (field) {\n        if (!children.has(field)) {\n          children.add(field);\n          var fieldNamePath = field.getNamePath();\n\n          if (field.isFieldDirty() && fieldNamePath.length) {\n            childrenFields.push(fieldNamePath);\n            fillChildren(fieldNamePath);\n          }\n        }\n      });\n    };\n\n    fillChildren(rootNamePath);\n    return childrenFields;\n  };\n\n  this.triggerOnFieldsChange = function (namePathList, filedErrors) {\n    var onFieldsChange = _this.callbacks.onFieldsChange;\n\n    if (onFieldsChange) {\n      var fields = _this.getFields();\n      /**\n       * Fill errors since `fields` may be replaced by controlled fields\n       */\n\n\n      if (filedErrors) {\n        var cache = new NameMap();\n        filedErrors.forEach(function (_ref4) {\n          var name = _ref4.name,\n              errors = _ref4.errors;\n          cache.set(name, errors);\n        });\n        fields.forEach(function (field) {\n          // eslint-disable-next-line no-param-reassign\n          field.errors = cache.get(field.name) || field.errors;\n        });\n      }\n\n      var changedFields = fields.filter(function (_ref5) {\n        var fieldName = _ref5.name;\n        return containsNamePath(namePathList, fieldName);\n      });\n      onFieldsChange(changedFields, fields);\n    }\n  };\n\n  this.validateFields = function (nameList, options) {\n    _this.warningUnhooked();\n\n    var provideNameList = !!nameList;\n    var namePathList = provideNameList ? nameList.map(getNamePath) : []; // Collect result in promise list\n\n    var promiseList = [];\n\n    _this.getFieldEntities(true).forEach(function (field) {\n      // Add field if not provide `nameList`\n      if (!provideNameList) {\n        namePathList.push(field.getNamePath());\n      }\n      /**\n       * Recursive validate if configured.\n       * TODO: perf improvement @zombieJ\n       */\n\n\n      if ((options === null || options === void 0 ? void 0 : options.recursive) && provideNameList) {\n        var namePath = field.getNamePath();\n\n        if ( // nameList[i] === undefined 说明是以 nameList 开头的\n        // ['name'] -> ['name','list']\n        namePath.every(function (nameUnit, i) {\n          return nameList[i] === nameUnit || nameList[i] === undefined;\n        })) {\n          namePathList.push(namePath);\n        }\n      } // Skip if without rule\n\n\n      if (!field.props.rules || !field.props.rules.length) {\n        return;\n      }\n\n      var fieldNamePath = field.getNamePath(); // Add field validate rule in to promise list\n\n      if (!provideNameList || containsNamePath(namePathList, fieldNamePath)) {\n        var promise = field.validateRules(_objectSpread({\n          validateMessages: _objectSpread(_objectSpread({}, defaultValidateMessages), _this.validateMessages)\n        }, options)); // Wrap promise with field\n\n        promiseList.push(promise.then(function () {\n          return {\n            name: fieldNamePath,\n            errors: [],\n            warnings: []\n          };\n        }).catch(function (ruleErrors) {\n          var mergedErrors = [];\n          var mergedWarnings = [];\n          ruleErrors.forEach(function (_ref6) {\n            var warningOnly = _ref6.rule.warningOnly,\n                errors = _ref6.errors;\n\n            if (warningOnly) {\n              mergedWarnings.push.apply(mergedWarnings, _toConsumableArray(errors));\n            } else {\n              mergedErrors.push.apply(mergedErrors, _toConsumableArray(errors));\n            }\n          });\n\n          if (mergedErrors.length) {\n            return Promise.reject({\n              name: fieldNamePath,\n              errors: mergedErrors,\n              warnings: mergedWarnings\n            });\n          }\n\n          return {\n            name: fieldNamePath,\n            errors: mergedErrors,\n            warnings: mergedWarnings\n          };\n        }));\n      }\n    });\n\n    var summaryPromise = allPromiseFinish(promiseList);\n    _this.lastValidatePromise = summaryPromise; // Notify fields with rule that validate has finished and need update\n\n    summaryPromise.catch(function (results) {\n      return results;\n    }).then(function (results) {\n      var resultNamePathList = results.map(function (_ref7) {\n        var name = _ref7.name;\n        return name;\n      });\n\n      _this.notifyObservers(_this.store, resultNamePathList, {\n        type: 'validateFinish'\n      });\n\n      _this.triggerOnFieldsChange(resultNamePathList, results);\n    });\n    var returnPromise = summaryPromise.then(function () {\n      if (_this.lastValidatePromise === summaryPromise) {\n        return Promise.resolve(_this.getFieldsValue(namePathList));\n      }\n\n      return Promise.reject([]);\n    }).catch(function (results) {\n      var errorList = results.filter(function (result) {\n        return result && result.errors.length;\n      });\n      return Promise.reject({\n        values: _this.getFieldsValue(namePathList),\n        errorFields: errorList,\n        outOfDate: _this.lastValidatePromise !== summaryPromise\n      });\n    }); // Do not throw in console\n\n    returnPromise.catch(function (e) {\n      return e;\n    });\n    return returnPromise;\n  };\n\n  this.submit = function () {\n    _this.warningUnhooked();\n\n    _this.validateFields().then(function (values) {\n      var onFinish = _this.callbacks.onFinish;\n\n      if (onFinish) {\n        try {\n          onFinish(values);\n        } catch (err) {\n          // Should print error if user `onFinish` callback failed\n          console.error(err);\n        }\n      }\n    }).catch(function (e) {\n      var onFinishFailed = _this.callbacks.onFinishFailed;\n\n      if (onFinishFailed) {\n        onFinishFailed(e);\n      }\n    });\n  };\n\n  this.forceRootUpdate = forceRootUpdate;\n});\n\nfunction useForm(form) {\n  var formRef = React.useRef();\n\n  var _React$useState = React.useState({}),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      forceUpdate = _React$useState2[1];\n\n  if (!formRef.current) {\n    if (form) {\n      formRef.current = form;\n    } else {\n      // Create a new FormStore if not provided\n      var forceReRender = function forceReRender() {\n        forceUpdate({});\n      };\n\n      var formStore = new FormStore(forceReRender);\n      formRef.current = formStore.getForm();\n    }\n  }\n\n  return [formRef.current];\n}\n\nexport default useForm;"]},"metadata":{},"sourceType":"module"}