{"ast":null,"code":"import { isArray } from 'lodash-es';\nimport rectPath from './rect-path';\nimport path2Curve from './path-2-curve';\n\nvar base3 = function (t, p1, p2, p3, p4) {\n  var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4;\n  var t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\n  return t * t2 - 3 * p1 + 3 * p2;\n};\n\nvar bezlen = function (x1, y1, x2, y2, x3, y3, x4, y4, z) {\n  if (z === null) {\n    z = 1;\n  }\n\n  z = z > 1 ? 1 : z < 0 ? 0 : z;\n  var z2 = z / 2;\n  var n = 12;\n  var Tvalues = [-0.1252, 0.1252, -0.3678, 0.3678, -0.5873, 0.5873, -0.7699, 0.7699, -0.9041, 0.9041, -0.9816, 0.9816];\n  var Cvalues = [0.2491, 0.2491, 0.2335, 0.2335, 0.2032, 0.2032, 0.1601, 0.1601, 0.1069, 0.1069, 0.0472, 0.0472];\n  var sum = 0;\n\n  for (var i = 0; i < n; i++) {\n    var ct = z2 * Tvalues[i] + z2;\n    var xbase = base3(ct, x1, x2, x3, x4);\n    var ybase = base3(ct, y1, y2, y3, y4);\n    var comb = xbase * xbase + ybase * ybase;\n    sum += Cvalues[i] * Math.sqrt(comb);\n  }\n\n  return z2 * sum;\n};\n\nvar curveDim = function (x0, y0, x1, y1, x2, y2, x3, y3) {\n  var tvalues = [];\n  var bounds = [[], []];\n  var a;\n  var b;\n  var c;\n  var t;\n\n  for (var i = 0; i < 2; ++i) {\n    if (i === 0) {\n      b = 6 * x0 - 12 * x1 + 6 * x2;\n      a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n      c = 3 * x1 - 3 * x0;\n    } else {\n      b = 6 * y0 - 12 * y1 + 6 * y2;\n      a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n      c = 3 * y1 - 3 * y0;\n    }\n\n    if (Math.abs(a) < 1e-12) {\n      if (Math.abs(b) < 1e-12) {\n        continue;\n      }\n\n      t = -c / b;\n\n      if (t > 0 && t < 1) {\n        tvalues.push(t);\n      }\n\n      continue;\n    }\n\n    var b2ac = b * b - 4 * c * a;\n    var sqrtb2ac = Math.sqrt(b2ac);\n\n    if (b2ac < 0) {\n      continue;\n    }\n\n    var t1 = (-b + sqrtb2ac) / (2 * a);\n\n    if (t1 > 0 && t1 < 1) {\n      tvalues.push(t1);\n    }\n\n    var t2 = (-b - sqrtb2ac) / (2 * a);\n\n    if (t2 > 0 && t2 < 1) {\n      tvalues.push(t2);\n    }\n  }\n\n  var j = tvalues.length;\n  var jlen = j;\n  var mt;\n\n  while (j--) {\n    t = tvalues[j];\n    mt = 1 - t;\n    bounds[0][j] = mt * mt * mt * x0 + 3 * mt * mt * t * x1 + 3 * mt * t * t * x2 + t * t * t * x3;\n    bounds[1][j] = mt * mt * mt * y0 + 3 * mt * mt * t * y1 + 3 * mt * t * t * y2 + t * t * t * y3;\n  }\n\n  bounds[0][jlen] = x0;\n  bounds[1][jlen] = y0;\n  bounds[0][jlen + 1] = x3;\n  bounds[1][jlen + 1] = y3;\n  bounds[0].length = bounds[1].length = jlen + 2;\n  return {\n    min: {\n      x: Math.min.apply(0, bounds[0]),\n      y: Math.min.apply(0, bounds[1])\n    },\n    max: {\n      x: Math.max.apply(0, bounds[0]),\n      y: Math.max.apply(0, bounds[1])\n    }\n  };\n};\n\nvar intersect = function (x1, y1, x2, y2, x3, y3, x4, y4) {\n  if (Math.max(x1, x2) < Math.min(x3, x4) || Math.min(x1, x2) > Math.max(x3, x4) || Math.max(y1, y2) < Math.min(y3, y4) || Math.min(y1, y2) > Math.max(y3, y4)) {\n    return;\n  }\n\n  var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4);\n  var ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4);\n  var denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n  if (!denominator) {\n    return;\n  }\n\n  var px = nx / denominator;\n  var py = ny / denominator;\n  var px2 = +px.toFixed(2);\n  var py2 = +py.toFixed(2);\n\n  if (px2 < +Math.min(x1, x2).toFixed(2) || px2 > +Math.max(x1, x2).toFixed(2) || px2 < +Math.min(x3, x4).toFixed(2) || px2 > +Math.max(x3, x4).toFixed(2) || py2 < +Math.min(y1, y2).toFixed(2) || py2 > +Math.max(y1, y2).toFixed(2) || py2 < +Math.min(y3, y4).toFixed(2) || py2 > +Math.max(y3, y4).toFixed(2)) {\n    return;\n  }\n\n  return {\n    x: px,\n    y: py\n  };\n};\n\nvar isPointInsideBBox = function (bbox, x, y) {\n  return x >= bbox.x && x <= bbox.x + bbox.width && y >= bbox.y && y <= bbox.y + bbox.height;\n};\n\nvar box = function (x, y, width, height) {\n  if (x === null) {\n    x = y = width = height = 0;\n  }\n\n  if (y === null) {\n    y = x.y;\n    width = x.width;\n    height = x.height;\n    x = x.x;\n  }\n\n  return {\n    x: x,\n    y: y,\n    width: width,\n    w: width,\n    height: height,\n    h: height,\n    x2: x + width,\n    y2: y + height,\n    cx: x + width / 2,\n    cy: y + height / 2,\n    r1: Math.min(width, height) / 2,\n    r2: Math.max(width, height) / 2,\n    r0: Math.sqrt(width * width + height * height) / 2,\n    path: rectPath(x, y, width, height),\n    vb: [x, y, width, height].join(' ')\n  };\n};\n\nvar isBBoxIntersect = function (bbox1, bbox2) {\n  // @ts-ignore\n  bbox1 = box(bbox1); // @ts-ignore\n\n  bbox2 = box(bbox2);\n  return isPointInsideBBox(bbox2, bbox1.x, bbox1.y) || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y) || isPointInsideBBox(bbox2, bbox1.x, bbox1.y2) || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y2) || isPointInsideBBox(bbox1, bbox2.x, bbox2.y) || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y) || isPointInsideBBox(bbox1, bbox2.x, bbox2.y2) || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y2) || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x) && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);\n};\n\nvar bezierBBox = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\n  if (!isArray(p1x)) {\n    p1x = [p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y];\n  }\n\n  var bbox = curveDim.apply(null, p1x);\n  return box(bbox.min.x, bbox.min.y, bbox.max.x - bbox.min.x, bbox.max.y - bbox.min.y);\n};\n\nvar findDotsAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n  var t1 = 1 - t;\n  var t13 = Math.pow(t1, 3);\n  var t12 = Math.pow(t1, 2);\n  var t2 = t * t;\n  var t3 = t2 * t;\n  var x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x;\n  var y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y;\n  var mx = p1x + 2 * t * (c1x - p1x) + t2 * (c2x - 2 * c1x + p1x);\n  var my = p1y + 2 * t * (c1y - p1y) + t2 * (c2y - 2 * c1y + p1y);\n  var nx = c1x + 2 * t * (c2x - c1x) + t2 * (p2x - 2 * c2x + c1x);\n  var ny = c1y + 2 * t * (c2y - c1y) + t2 * (p2y - 2 * c2y + c1y);\n  var ax = t1 * p1x + t * c1x;\n  var ay = t1 * p1y + t * c1y;\n  var cx = t1 * c2x + t * p2x;\n  var cy = t1 * c2y + t * p2y;\n  var alpha = 90 - Math.atan2(mx - nx, my - ny) * 180 / Math.PI; // (mx > nx || my < ny) && (alpha += 180);\n\n  return {\n    x: x,\n    y: y,\n    m: {\n      x: mx,\n      y: my\n    },\n    n: {\n      x: nx,\n      y: ny\n    },\n    start: {\n      x: ax,\n      y: ay\n    },\n    end: {\n      x: cx,\n      y: cy\n    },\n    alpha: alpha\n  };\n};\n\nvar interHelper = function (bez1, bez2, justCount) {\n  // @ts-ignore\n  var bbox1 = bezierBBox(bez1); // @ts-ignore\n\n  var bbox2 = bezierBBox(bez2);\n\n  if (!isBBoxIntersect(bbox1, bbox2)) {\n    return justCount ? 0 : [];\n  }\n\n  var l1 = bezlen.apply(0, bez1);\n  var l2 = bezlen.apply(0, bez2);\n  var n1 = ~~(l1 / 8);\n  var n2 = ~~(l2 / 8);\n  var dots1 = [];\n  var dots2 = [];\n  var xy = {};\n  var res = justCount ? 0 : [];\n\n  for (var i = 0; i < n1 + 1; i++) {\n    var d = findDotsAtSegment.apply(0, bez1.concat(i / n1));\n    dots1.push({\n      x: d.x,\n      y: d.y,\n      t: i / n1\n    });\n  }\n\n  for (var i = 0; i < n2 + 1; i++) {\n    var d = findDotsAtSegment.apply(0, bez2.concat(i / n2));\n    dots2.push({\n      x: d.x,\n      y: d.y,\n      t: i / n2\n    });\n  }\n\n  for (var i = 0; i < n1; i++) {\n    for (var j = 0; j < n2; j++) {\n      var di = dots1[i];\n      var di1 = dots1[i + 1];\n      var dj = dots2[j];\n      var dj1 = dots2[j + 1];\n      var ci = Math.abs(di1.x - di.x) < 0.001 ? 'y' : 'x';\n      var cj = Math.abs(dj1.x - dj.x) < 0.001 ? 'y' : 'x';\n      var is = intersect(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y);\n\n      if (is) {\n        if (xy[is.x.toFixed(4)] === is.y.toFixed(4)) {\n          continue;\n        }\n\n        xy[is.x.toFixed(4)] = is.y.toFixed(4);\n        var t1 = di.t + Math.abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t);\n        var t2 = dj.t + Math.abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\n\n        if (t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1) {\n          if (justCount) {\n            // @ts-ignore\n            res++;\n          } else {\n            // @ts-ignore\n            res.push({\n              x: is.x,\n              y: is.y,\n              t1: t1,\n              t2: t2\n            });\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n};\n\nvar interPathHelper = function (path1, path2, justCount) {\n  // @ts-ignore\n  path1 = path2Curve(path1); // @ts-ignore\n\n  path2 = path2Curve(path2);\n  var x1;\n  var y1;\n  var x2;\n  var y2;\n  var x1m;\n  var y1m;\n  var x2m;\n  var y2m;\n  var bez1;\n  var bez2;\n  var res = justCount ? 0 : [];\n\n  for (var i = 0, ii = path1.length; i < ii; i++) {\n    var pi = path1[i];\n\n    if (pi[0] === 'M') {\n      x1 = x1m = pi[1];\n      y1 = y1m = pi[2];\n    } else {\n      if (pi[0] === 'C') {\n        bez1 = [x1, y1].concat(pi.slice(1));\n        x1 = bez1[6];\n        y1 = bez1[7];\n      } else {\n        bez1 = [x1, y1, x1, y1, x1m, y1m, x1m, y1m];\n        x1 = x1m;\n        y1 = y1m;\n      }\n\n      for (var j = 0, jj = path2.length; j < jj; j++) {\n        var pj = path2[j];\n\n        if (pj[0] === 'M') {\n          x2 = x2m = pj[1];\n          y2 = y2m = pj[2];\n        } else {\n          if (pj[0] === 'C') {\n            bez2 = [x2, y2].concat(pj.slice(1));\n            x2 = bez2[6];\n            y2 = bez2[7];\n          } else {\n            bez2 = [x2, y2, x2, y2, x2m, y2m, x2m, y2m];\n            x2 = x2m;\n            y2 = y2m;\n          }\n\n          var intr = interHelper(bez1, bez2, justCount);\n\n          if (justCount) {\n            // @ts-ignore\n            res += intr;\n          } else {\n            // @ts-ignore\n            for (var k = 0, kk = intr.length; k < kk; k++) {\n              intr[k].segment1 = i;\n              intr[k].segment2 = j;\n              intr[k].bez1 = bez1;\n              intr[k].bez2 = bez2;\n            } // @ts-ignore\n\n\n            res = res.concat(intr);\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n};\n\nexport default function pathIntersection(path1, path2) {\n  // @ts-ignore\n  return interPathHelper(path1, path2);\n}","map":{"version":3,"mappings":"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","names":["isArray","rectPath","path2Curve","base3","t","p1","p2","p3","p4","t1","t2","bezlen","x1","y1","x2","y2","x3","y3","x4","y4","z","z2","n","Tvalues","Cvalues","sum","i","ct","xbase","ybase","comb","Math","sqrt","curveDim","x0","y0","tvalues","bounds","a","b","c","abs","push","b2ac","sqrtb2ac","j","length","jlen","mt","min","x","apply","y","max","intersect","nx","ny","denominator","px","py","px2","toFixed","py2","isPointInsideBBox","bbox","width","height","box","w","h","cx","cy","r1","r2","r0","path","vb","join","isBBoxIntersect","bbox1","bbox2","bezierBBox","p1x","p1y","c1x","c1y","c2x","c2y","p2x","p2y","findDotsAtSegment","t13","pow","t12","t3","mx","my","ax","ay","alpha","atan2","PI","m","start","end","interHelper","bez1","bez2","justCount","l1","l2","n1","n2","dots1","dots2","xy","res","d","concat","di","di1","dj","dj1","ci","cj","is","interPathHelper","path1","path2","x1m","y1m","x2m","y2m","ii","pi","slice","jj","pj","intr","k","kk","segment1","segment2","pathIntersection"],"sources":["/Users/dennis.zhang/Desktop/其它代码库/moa-flow/node_modules/@antv/path-util/src/path-intersection.ts"],"sourcesContent":["import { isArray } from 'lodash-es';\n\nimport rectPath from './rect-path';\nimport path2Curve from './path-2-curve';\n\nconst base3 = function (t: number, p1: number, p2: number, p3: number, p4: number): number {\n  const t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4;\n  const t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\n  return t * t2 - 3 * p1 + 3 * p2;\n};\n\nconst bezlen = function (\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  x3: number,\n  y3: number,\n  x4: number,\n  y4: number,\n  z: number\n): number {\n  if (z === null) {\n    z = 1;\n  }\n  z = z > 1 ? 1 : z < 0 ? 0 : z;\n  const z2 = z / 2;\n  const n = 12;\n  const Tvalues = [\n    -0.1252, 0.1252, -0.3678, 0.3678, -0.5873, 0.5873, -0.7699, 0.7699, -0.9041, 0.9041, -0.9816, 0.9816,\n  ];\n  const Cvalues = [0.2491, 0.2491, 0.2335, 0.2335, 0.2032, 0.2032, 0.1601, 0.1601, 0.1069, 0.1069, 0.0472, 0.0472];\n  let sum = 0;\n  for (let i = 0; i < n; i++) {\n    const ct = z2 * Tvalues[i] + z2;\n    const xbase = base3(ct, x1, x2, x3, x4);\n    const ybase = base3(ct, y1, y2, y3, y4);\n    const comb = xbase * xbase + ybase * ybase;\n    sum += Cvalues[i] * Math.sqrt(comb);\n  }\n  return z2 * sum;\n};\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface BoundPoint {\n  min: Point;\n  max: Point;\n}\n\nconst curveDim = function (\n  x0: number,\n  y0: number,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  x3: number,\n  y3: number\n): BoundPoint {\n  const tvalues = [];\n  const bounds = [[], []];\n  let a;\n  let b;\n  let c;\n  let t;\n\n  for (let i = 0; i < 2; ++i) {\n    if (i === 0) {\n      b = 6 * x0 - 12 * x1 + 6 * x2;\n      a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n      c = 3 * x1 - 3 * x0;\n    } else {\n      b = 6 * y0 - 12 * y1 + 6 * y2;\n      a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n      c = 3 * y1 - 3 * y0;\n    }\n    if (Math.abs(a) < 1e-12) {\n      if (Math.abs(b) < 1e-12) {\n        continue;\n      }\n      t = -c / b;\n      if (t > 0 && t < 1) {\n        tvalues.push(t);\n      }\n      continue;\n    }\n    const b2ac = b * b - 4 * c * a;\n    const sqrtb2ac = Math.sqrt(b2ac);\n    if (b2ac < 0) {\n      continue;\n    }\n    const t1 = (-b + sqrtb2ac) / (2 * a);\n    if (t1 > 0 && t1 < 1) {\n      tvalues.push(t1);\n    }\n    const t2 = (-b - sqrtb2ac) / (2 * a);\n    if (t2 > 0 && t2 < 1) {\n      tvalues.push(t2);\n    }\n  }\n\n  let j = tvalues.length;\n  const jlen = j;\n  let mt;\n  while (j--) {\n    t = tvalues[j];\n    mt = 1 - t;\n    bounds[0][j] = mt * mt * mt * x0 + 3 * mt * mt * t * x1 + 3 * mt * t * t * x2 + t * t * t * x3;\n    bounds[1][j] = mt * mt * mt * y0 + 3 * mt * mt * t * y1 + 3 * mt * t * t * y2 + t * t * t * y3;\n  }\n\n  bounds[0][jlen] = x0;\n  bounds[1][jlen] = y0;\n  bounds[0][jlen + 1] = x3;\n  bounds[1][jlen + 1] = y3;\n  bounds[0].length = bounds[1].length = jlen + 2;\n\n  return {\n    min: {\n      x: Math.min.apply(0, bounds[0]),\n      y: Math.min.apply(0, bounds[1]),\n    },\n    max: {\n      x: Math.max.apply(0, bounds[0]),\n      y: Math.max.apply(0, bounds[1]),\n    },\n  };\n};\n\nconst intersect = function (\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  x3: number,\n  y3: number,\n  x4: number,\n  y4: number\n): Point {\n  if (\n    Math.max(x1, x2) < Math.min(x3, x4) ||\n    Math.min(x1, x2) > Math.max(x3, x4) ||\n    Math.max(y1, y2) < Math.min(y3, y4) ||\n    Math.min(y1, y2) > Math.max(y3, y4)\n  ) {\n    return;\n  }\n  const nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4);\n  const ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4);\n  const denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n  if (!denominator) {\n    return;\n  }\n  const px = nx / denominator;\n  const py = ny / denominator;\n  const px2 = +px.toFixed(2);\n  const py2 = +py.toFixed(2);\n  if (\n    px2 < +Math.min(x1, x2).toFixed(2) ||\n    px2 > +Math.max(x1, x2).toFixed(2) ||\n    px2 < +Math.min(x3, x4).toFixed(2) ||\n    px2 > +Math.max(x3, x4).toFixed(2) ||\n    py2 < +Math.min(y1, y2).toFixed(2) ||\n    py2 > +Math.max(y1, y2).toFixed(2) ||\n    py2 < +Math.min(y3, y4).toFixed(2) ||\n    py2 > +Math.max(y3, y4).toFixed(2)\n  ) {\n    return;\n  }\n  return {\n    x: px,\n    y: py,\n  };\n};\n\nconst isPointInsideBBox = function (bbox, x, y) {\n  return x >= bbox.x && x <= bbox.x + bbox.width && y >= bbox.y && y <= bbox.y + bbox.height;\n};\n\nconst box = function (x, y, width, height) {\n  if (x === null) {\n    x = y = width = height = 0;\n  }\n  if (y === null) {\n    y = x.y;\n    width = x.width;\n    height = x.height;\n    x = x.x;\n  }\n  return {\n    x,\n    y,\n    width,\n    w: width,\n    height,\n    h: height,\n    x2: x + width,\n    y2: y + height,\n    cx: x + width / 2,\n    cy: y + height / 2,\n    r1: Math.min(width, height) / 2,\n    r2: Math.max(width, height) / 2,\n    r0: Math.sqrt(width * width + height * height) / 2,\n    path: rectPath(x, y, width, height),\n    vb: [x, y, width, height].join(' '),\n  };\n};\n\nconst isBBoxIntersect = function (bbox1, bbox2) {\n  // @ts-ignore\n  bbox1 = box(bbox1);\n  // @ts-ignore\n  bbox2 = box(bbox2);\n  return (\n    isPointInsideBBox(bbox2, bbox1.x, bbox1.y) ||\n    isPointInsideBBox(bbox2, bbox1.x2, bbox1.y) ||\n    isPointInsideBBox(bbox2, bbox1.x, bbox1.y2) ||\n    isPointInsideBBox(bbox2, bbox1.x2, bbox1.y2) ||\n    isPointInsideBBox(bbox1, bbox2.x, bbox2.y) ||\n    isPointInsideBBox(bbox1, bbox2.x2, bbox2.y) ||\n    isPointInsideBBox(bbox1, bbox2.x, bbox2.y2) ||\n    isPointInsideBBox(bbox1, bbox2.x2, bbox2.y2) ||\n    (((bbox1.x < bbox2.x2 && bbox1.x > bbox2.x) || (bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)) &&\n      ((bbox1.y < bbox2.y2 && bbox1.y > bbox2.y) || (bbox2.y < bbox1.y2 && bbox2.y > bbox1.y)))\n  );\n};\n\nconst bezierBBox = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\n  if (!isArray(p1x)) {\n    p1x = [p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y];\n  }\n  const bbox = curveDim.apply(null, p1x);\n  return box(bbox.min.x, bbox.min.y, bbox.max.x - bbox.min.x, bbox.max.y - bbox.min.y);\n};\n\nconst findDotsAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n  const t1 = 1 - t;\n  const t13 = Math.pow(t1, 3);\n  const t12 = Math.pow(t1, 2);\n  const t2 = t * t;\n  const t3 = t2 * t;\n  const x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x;\n  const y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y;\n  const mx = p1x + 2 * t * (c1x - p1x) + t2 * (c2x - 2 * c1x + p1x);\n  const my = p1y + 2 * t * (c1y - p1y) + t2 * (c2y - 2 * c1y + p1y);\n  const nx = c1x + 2 * t * (c2x - c1x) + t2 * (p2x - 2 * c2x + c1x);\n  const ny = c1y + 2 * t * (c2y - c1y) + t2 * (p2y - 2 * c2y + c1y);\n  const ax = t1 * p1x + t * c1x;\n  const ay = t1 * p1y + t * c1y;\n  const cx = t1 * c2x + t * p2x;\n  const cy = t1 * c2y + t * p2y;\n  const alpha = 90 - (Math.atan2(mx - nx, my - ny) * 180) / Math.PI;\n  // (mx > nx || my < ny) && (alpha += 180);\n  return {\n    x,\n    y,\n    m: {\n      x: mx,\n      y: my,\n    },\n    n: {\n      x: nx,\n      y: ny,\n    },\n    start: {\n      x: ax,\n      y: ay,\n    },\n    end: {\n      x: cx,\n      y: cy,\n    },\n    alpha,\n  };\n};\n\nconst interHelper = function (bez1, bez2, justCount) {\n  // @ts-ignore\n  const bbox1 = bezierBBox(bez1);\n  // @ts-ignore\n  const bbox2 = bezierBBox(bez2);\n  if (!isBBoxIntersect(bbox1, bbox2)) {\n    return justCount ? 0 : [];\n  }\n  const l1 = bezlen.apply(0, bez1);\n  const l2 = bezlen.apply(0, bez2);\n  const n1 = ~~(l1 / 8);\n  const n2 = ~~(l2 / 8);\n  const dots1 = [];\n  const dots2 = [];\n  const xy = {};\n  let res = justCount ? 0 : [];\n  for (let i = 0; i < n1 + 1; i++) {\n    const d = findDotsAtSegment.apply(0, bez1.concat(i / n1));\n    dots1.push({\n      x: d.x,\n      y: d.y,\n      t: i / n1,\n    });\n  }\n  for (let i = 0; i < n2 + 1; i++) {\n    const d = findDotsAtSegment.apply(0, bez2.concat(i / n2));\n    dots2.push({\n      x: d.x,\n      y: d.y,\n      t: i / n2,\n    });\n  }\n  for (let i = 0; i < n1; i++) {\n    for (let j = 0; j < n2; j++) {\n      const di = dots1[i];\n      const di1 = dots1[i + 1];\n      const dj = dots2[j];\n      const dj1 = dots2[j + 1];\n      const ci = Math.abs(di1.x - di.x) < 0.001 ? 'y' : 'x';\n      const cj = Math.abs(dj1.x - dj.x) < 0.001 ? 'y' : 'x';\n      const is = intersect(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y);\n      if (is) {\n        if (xy[is.x.toFixed(4)] === is.y.toFixed(4)) {\n          continue;\n        }\n        xy[is.x.toFixed(4)] = is.y.toFixed(4);\n        const t1 = di.t + Math.abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t);\n        const t2 = dj.t + Math.abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\n        if (t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1) {\n          if (justCount) {\n            // @ts-ignore\n            res++;\n          } else {\n            // @ts-ignore\n            res.push({\n              x: is.x,\n              y: is.y,\n              t1,\n              t2,\n            });\n          }\n        }\n      }\n    }\n  }\n  return res;\n};\n\nconst interPathHelper = function (path1, path2, justCount) {\n  // @ts-ignore\n  path1 = path2Curve(path1);\n  // @ts-ignore\n  path2 = path2Curve(path2);\n  let x1;\n  let y1;\n  let x2;\n  let y2;\n  let x1m;\n  let y1m;\n  let x2m;\n  let y2m;\n  let bez1;\n  let bez2;\n  let res = justCount ? 0 : [];\n  for (let i = 0, ii = path1.length; i < ii; i++) {\n    const pi = path1[i];\n    if (pi[0] === 'M') {\n      x1 = x1m = pi[1];\n      y1 = y1m = pi[2];\n    } else {\n      if (pi[0] === 'C') {\n        bez1 = [x1, y1].concat(pi.slice(1));\n        x1 = bez1[6];\n        y1 = bez1[7];\n      } else {\n        bez1 = [x1, y1, x1, y1, x1m, y1m, x1m, y1m];\n        x1 = x1m;\n        y1 = y1m;\n      }\n      for (let j = 0, jj = path2.length; j < jj; j++) {\n        const pj = path2[j];\n        if (pj[0] === 'M') {\n          x2 = x2m = pj[1];\n          y2 = y2m = pj[2];\n        } else {\n          if (pj[0] === 'C') {\n            bez2 = [x2, y2].concat(pj.slice(1));\n            x2 = bez2[6];\n            y2 = bez2[7];\n          } else {\n            bez2 = [x2, y2, x2, y2, x2m, y2m, x2m, y2m];\n            x2 = x2m;\n            y2 = y2m;\n          }\n          const intr = interHelper(bez1, bez2, justCount);\n          if (justCount) {\n            // @ts-ignore\n            res += intr;\n          } else {\n            // @ts-ignore\n            for (let k = 0, kk = intr.length; k < kk; k++) {\n              intr[k].segment1 = i;\n              intr[k].segment2 = j;\n              intr[k].bez1 = bez1;\n              intr[k].bez2 = bez2;\n            }\n            // @ts-ignore\n            res = res.concat(intr);\n          }\n        }\n      }\n    }\n  }\n  return res;\n};\n\nexport default function pathIntersection(path1, path2) {\n  // @ts-ignore\n  return interPathHelper(path1, path2);\n}\n"]},"metadata":{},"sourceType":"module"}