# 该文件是为在 https://aci.alipay.com 上，手动配置和触发流水线准备的

stages:
  - 质量保障

environments:
  NODE_ENV: "test"
  DINGTALK_WEBHOOK: "https://oapi.dingtalk.com/robot/send\?access_token\=fc47c79da1b7f8d50ca7824d491d4e885db01465a114cf4b4bf7e096cfa77485"

beforeScript:
  - |
    export PATH=$PWD/node_modules/.bin:/root/.cli:$PATH
    echo $PATH
    time curl -v -L -o- https://bash-scripts.antfin-inc.com/install-tnpm-standalone.js | bash
    tnpm -v

Copilot Check:
  stage: 质量保障
  aciTags: DOCKER
  agent:
    docker:
      image: reg.docker.alibaba-inc.com/dockerlab/node-ci:3.8.6
  script:
    - |
      export PATH=$PWD/node_modules/.bin:/root/.cli:$PATH
      node -e "console.log('%j, %j', process.versions, process.execPath)"
      tnpm i -g @alipay/copilot-cli
      copilot --version
      copilot check --list-rules
      copilot check
